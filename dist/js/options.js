!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t,n){"use strict";n.d(t,"t",function(){return c}),n.d(t,"u",function(){return l}),n.d(t,"v",function(){return d}),n.d(t,"w",function(){return u}),n.d(t,"d",function(){return p}),n.d(t,"q",function(){return r}),n.d(t,"g",function(){return a}),n.d(t,"a",function(){return s}),n.d(t,"p",function(){return h}),n.d(t,"r",function(){return f}),n.d(t,"b",function(){return g}),n.d(t,"s",function(){return b}),n.d(t,"j",function(){return w}),n.d(t,"e",function(){return S}),n.d(t,"c",function(){return D}),n.d(t,"k",function(){return T}),n.d(t,"o",function(){return v}),n.d(t,"i",function(){return O}),n.d(t,"h",function(){return C}),n.d(t,"n",function(){return L}),n.d(t,"f",function(){return P}),n.d(t,"l",function(){return _}),n.d(t,"m",function(){return N}),n.d(t,"x",function(){return A});var o=n(5),i=n(6);function r(e){return e&&e.id&&e.url&&!i.e.BLOCKED_PATTERNS.some(t=>t.test(e.url))}function a(e){const t=function(){let e;try{throw new Error("")}catch(t){e=t.stack||""}return(e=e.split("\n").map(e=>e.trim())).splice("Error"===e[0]?2:1)}().join("\n");return function(...n){chrome.runtime.lastError&&(console.log("CRLError: ".concat(chrome.runtime.lastError.message)),console.log(t)),e&&e(...n)}}const s={q(e){return(this||document).querySelector(e)},Q(e){return(this||document).querySelectorAll(e)},qId(e){return(this||document).getElementById(e)},qCls(e){return[...(this||document).getElementsByClassName(e)]},qClsSingle(e){const t=(this||document).qCls(e);return t?t[0]:null}},{q:c,qCls:l,qClsSingle:d,qId:u,Q:p}=s;function h(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(e){return 3===e.nodeType}c.new=function(e){return document.createElement(e)};const m=i.a.ENABLED,g=i.a.OBJECT_NAME_LIMIT,b=i.e.BLOCKED_PATTERNS[4];let E,y;m?(y=console.log.bind(console),E=console.dir.bind(console)):(y=function(){},E=function(){});const w=y,S=i.b.SHOW_CLASS,D=i.b.PRIMITIVES_EXT_KEY;function T(e){return e.replace(/[-[\]/{}())*+?.\\^$|]/g,"\\$&")}function v(e,t){const n=e&&e.tagName;if(!e||"TEXTAREA"===n||"INPUT"===n||!e.getAttribute)return!1;let o;const i=e.attr?e.attr("contenteditable"):null;if(""===i||"true"===i||"plaintext-only"===i)return!0;if(t)return!1;o=e;do{if(!(o=o.parentNode))return!1;if(v(o,!0))return!0}while(o!==window.document);return!1}function O(e,t=i.d.DEFAULT_DEBOUNCE_DELAY,n){let o;return function(...i){const r=this,a=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(r,i)},t),a&&e.apply(r,i)}}function C(e){const t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(t)}function L(e){const t=e.replace(b,"");for(const e of Data.blockedSites){if(new RegExp("^".concat(T(e))).test(t))return!0}return!1}function P(e,t,n){const r=new Blob([t],{type:"text/js"});e.href=i.e.createObjectURL(r),e.download="".concat(n," ").concat(Object(o.d)(),".txt")}function _(e){return"<span class=notranslate>".concat(e,"</span>")}function N(e){return e.ownerDocument.defaultView}function A(e){e.dispatchEvent(new Event("input",{cancelable:!0,bubbles:!0}))}},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"d",function(){return s}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return l});var o=n(0),i=n(7),r=n(5);function a(){this.matchesUnique=function(e){return this.name.toLowerCase()===e.toLowerCase()},this.matchesNameLazy=function(e){return new RegExp(e,"i").test(this.name)},this.matchesLazy=function(e){return new RegExp(e,"i").test(this.name+this.strippedBody)},this.matchesWord=function(e){return new RegExp("\\b".concat(e,"\\b"),"i").test(this.name+this.strippedBody)},this.remove=function(){const e=Data.snippets.getUniqueObjectIndex(this.name,this.type),t=e[e.length-1];this.getParentFolder().list.splice(t,1),c.setIndices()},this.getParentFolder=function(){let e=Data.snippets.getUniqueObjectIndex(this.name,this.type),t=Data.snippets;for(let n=0,o=e.length-1;n<o;n++)t=t.list[e[n]];return t},this.moveTo=function(e){const t=this.getDuplicatedObject();return this.remove(),c.insertObject(t,e),t},this.canNestUnder=function(e){if(c.isFolder(this))for(;e.name!==c.MAIN_SNIPPETS_NAME;){if(this.name===e.name)return!1;e=e.getParentFolder()}return!0},this.getClone=function(){if(this.type===a.SNIP_TYPE)return new s(this.name,this.body,this.timestamp);const e=new c(this.name,[],this.timestamp);return this.list.forEach(t=>{e.list.push(t.getClone())}),e},this.insertAdjacent=function(e,t,n){const o=this.name,i=this.type,r=Data.snippets.getUniqueObjectIndex(o,i),a=r[r.length-1]+(t?+t:1)*(n?0:1);this.getParentFolder().list.splice(a,0,e),c.setIndices()}}function s(e,t,n){this.name=e,this.body=t,this.timestamp=n||Date.now(),this.type=a.SNIP_TYPE,this.edit=function(e,t){this.name=e;try{if("string"==typeof t&&t.startsWith("{")){const e=JSON.parse(t);if(e&&("quill-table-content"===e.type||"html"===e.type))return void(this.body=t)}}catch(e){console.log("Error parsing body JSON:",e)}this.body=JSON.stringify({type:"html",html:t,delta:null})},this.getDOMElement=function(e){const t=a.prototype.getDOMElement.call(this,e),n=t.qClsSingle("name"),i=o.t.new("div").addClass("body");function r(e){const o=function(e){try{if("string"==typeof e&&e.trim().startsWith("{")){const t=JSON.parse(e);if(t&&t.html)return"quill-table-content"===t.type?t.html.replace(/<table/g,'<table class="dotexpander-table"').replace(/<td/g,'<td class="prokeys-cell"').replace(/<th/g,'<th class="prokeys-cell"'):t.html}}catch(e){console.log("Content is not JSON, using as plain text")}return"<div>".concat(String(e).replace(/\n/g,"<br>"),"</div>")}(e.body);if(t.hasClass(s.DOMContractedClass)){const e=o.replace(/\<[^\>]+\>/g," ").replace(/\s+/g," ").replace(/&[^;]+;/g," ").trim().substring(0,s.MAX_COLLAPSED_CHARACTERS_DISPLAYED);i.text(e),setTimeout(()=>{i.style.width="calc(100% - 100px - ".concat(n.clientWidth,"px)")},1)}else i.html(o).style.width=""}t.appendChild(i),t.appendChild(o.t.new("div").addClass("clickable").on("click",a.prototype.preventButtonClickOverride(()=>{t.toggleClass(s.DOMContractedClass),r(this)}))),r(this);const c=o.t.new("div").addClass("timestamp").html(s.getTimestampString(this));return t.appendChild(c),t},this.getDuplicatedObject=function(){return new s(this.name,this.body,this.timestamp)},this.toArray=function(){return{name:this.name,body:this.body,timestamp:this.timestamp}},this.formatMacros=function(e){const t=[this.name],n={};function i(e,t,n,o){const i=(e=e.replace(new RegExp("^\\".concat(o)),"")).split(new RegExp("\\".concat(t),"g")).slice(0,n).join(t);return i?o+i:""}function a(e,t,n,o){return e.replace(new RegExp("^\\".concat(o)),"").split(t)[n-1]}let c=function e(o){return o.replace(/\[\[%s\((.*?)\)\]\]/g,(o,i)=>{if(t.indexOf(i)>-1)return o;const r=Data.snippets.getUniqueSnip(i),a=r&&r.name;return r?(t.push(a),n[a]?n[a]:(n[a]=e(r.body),n[a])):o})}(this.body);c=(c=(c=c.replace(/\[\[%d\((!?)(.*?)\)\]\]/g,(e,t,n)=>{let o,i,a,s,c,l,d=new Date,u=n;function p(e,n){let o=0;n?(n=parseInt(n,10),/M/.test(a)&&(o+=Object(r.e)(n)*r.b),o+=c*n):a=a.replace(/[^a-zA-Z\\/]/g,"").replace("\\d",""),t&&d.setTime(d.getTime()+o),l=t?d:new Date(Date.now()+o),u=u.replace(new RegExp(a),s(l))}t=!!t;for(const e of r.a)o=e,[a,[s,c]]=o,i=new RegExp(a,"g"),n.replace(i,p);return u})).replace(/\[\[%u\((.*?)\)\]\]/g,(e,t)=>{let n="",o=t.match(/(q?)\d+/),r=t.match(/q(\d+)/);return o=o?o[1]?0:+o[0]:100,r=r?r[1]?+r[1]:100:0,/p/i.test(t)&&(n+="".concat(window.location.protocol,"//")),/w/i.test(t)&&(n+="www."),n+=window.location.host,n+=i(window.location.pathname,"/",o,"/"),n+=i(window.location.search,"&",r,"?"),/h/i.test(t)&&(n+=window.location.hash),n})).replace(/\[\[%u\{(\w|\d+|q\d+)\}\]\]/g,(e,t)=>{let n;return Number.isInteger(+t)?a(window.location.pathname,"/",+t,"/"):"p"===t?window.location.protocol.replace(/:$/,""):"w"===t?"www":"h"===t?(({hash:n}=window.location),n&&n.substring(1)||""):"q"===t[0]?a(window.location.search,"&",+t.substring(1),"?"):""}),s.PASTE_MACRO_REGEX.test(c)?chrome.runtime.sendMessage("givePasteData",Object(o.g)(t=>{e(c.replace(s.PASTE_MACRO_REGEX,t))})):e(c)}}function c(e,t,n,r){function l(e){return function(){return this.list.reduce((t,n)=>n.type===e?t+1:t,0)}}function u(e){return function(t,n,o){const i=e?new s(t,n,o):new c(t,n,o);c.insertObject(i,this),window.latestRevisionLabel="created ".concat(i.type,' "').concat(i.name,'"')}}function p(e){return function(t,n,o){Data.snippets.getUniqueObject(t,e).edit(n,o),window.latestRevisionLabel="edited ".concat(e,' "').concat(t,'"')}}function h(e){return function(t){return this.getUniqueObject(t,e)}}function f(e){return function(t){return this.getUniqueObjectIndex(t,e)}}function m(e){const t=o.t.new("div").addClass("path_part"),n=o.t.new("div").addClass("right_arrow");t.dataset.name=e,$containerFolderPath.appendChild(t.html(Object(o.l)(e))),$containerFolderPath.appendChild(n)}function g(e,t){return t.replace(new RegExp(Object(o.k)(e),"ig"),e=>"<match>".concat(e,"</match>"))}function b(e){const t=function(n,o){this.list.forEach(i=>{!o&&c.isFolder(i)&&t.call(i,n,!1),i.type===e&&n(i)})};return t}console.log("[DEBUG] Creating new Folder:",{orgName:e,list:t,orgTimestamp:n,isSearchResultFolder:r}),console.log("[DEBUG] IN_OPTIONS_PAGE in Folder constructor:",window.IN_OPTIONS_PAGE),this.name=e,this.type=a.FOLDER_TYPE,this.timestamp=n||Date.now(),this.list=(t||[]).slice(0),this.isSearchResultFolder=!!r,window.IN_OPTIONS_PAGE&&(console.log("[DEBUG] In options page, observing list"),d(this.list)),this.getSnippetCount=l(a.SNIP_TYPE),this.getFolderCount=l(a.FOLDER_TYPE),this.getLastFolderIndex=function(){let e=0,t=this.list.length;for(;e<t&&c.isFolder(this.list[e]);)e++;return e-1},this.addSnip=u(!0),this.editSnip=p(a.SNIP_TYPE),this.addFolder=u(!1),this.editFolder=p(a.FOLDER_TYPE),this.edit=function(e){this.name=e},this.getDOMElement=function(e){return a.prototype.getDOMElement.call(this,e).on("click",a.prototype.preventButtonClickOverride(this.listSnippets.bind(this)))},this.getDOMElementFull=function(e){let t,n,i,r=o.t.new("div"),a=this.list.length;for(let o=0;o<a;o++)n=(t=this.list[o]).getDOMElement(e),r.appendChild(n);return 0===a&&((i=o.t.new("div")).addClass("empty_folder").html(this.isSearchResultFolder?"No matches found":"This folder is empty"),r.appendChild(i)),r},this.getUniqueObject=function(e,t){const n=this.getUniqueObjectIndex(e,t);if(!n)return null;let o=this;for(const e of n)o=o.list[e];return o},this.getUniqueObjectIndex=function(e,t){return c.indices[t][e.toLowerCase()]},this.getUniqueSnip=h(a.SNIP_TYPE),this.getUniqueSnipIndex=f(a.SNIP_TYPE),this.getUniqueFolder=h(a.FOLDER_TYPE),this.getUniqueFolderIndex=f(a.FOLDER_TYPE),this.stripAllSnippetsTags=function(e){e=e||o.t.new("DIV"),this.hasStrippedSnippets=!0,this.list.forEach(t=>{c.isFolder(t)?t.stripAllSnippetsTags(e):t.strippedBody=s.stripAllTags(t.body,e)})},this.searchSnippets=function(e){return e=Object(o.k)(e),this.hasStrippedSnippets||this.stripAllSnippetsTags(),new c(c.SEARCH_RESULTS_NAME+this.name,this.list.reduce((t,n)=>(c.isFolder(n)&&(t=t.concat(n.searchSnippets(e).list)),n.matchesLazy(e)&&t.push(n),t),[]).sort((t,n)=>n.matchesUnique(e)?1:t.matchesUnique(e)?-1:n.matchesNameLazy(e)?1:!t.matchesNameLazy(e)&&n.matchesWord(e)?1:-1),void 0,!0)},this.sort=function(e,t){const n="alphabetic"===e,o=this.getLastFolderIndex()+1,i=this.list.slice(0,o),r=this.list.slice(o);function a(e){return e.sort((e,t)=>{const o=e.name.localeCompare(t.name);return n?o:e.timestamp-t.timestamp||o}),t?e.reverse():e}this.list=a(i).concat(a(r))},this.listSnippets=function(e){e=Object(o.p)(e)?void 0:e,$containerSnippets.html("").appendChild(this.getDOMElementFull(e)),this.insertFolderPathDOM()},this.insertFolderPathDOM=function(){if($containerFolderPath.html(""),this.isSearchResultFolder)return void m(this.name);m(c.MAIN_SNIPPETS_NAME);let e=Data.snippets.getUniqueFolderIndex(this.name),t=Data.snippets;for(const n of e)m((t=t.list[n]).name);c.implementChevronInFolderPath()},this.toArray=function(){return[this.name,this.timestamp].concat(this.list.map(e=>e.toArray()))},this.filterSnippetsForOmnibox=function(e,t){const n=[],i=this.searchSnippets(e);i.forEachSnippet(t=>{t.formatMacros(i=>{i=function(e){const t=o.t.new("div");return t.innerHTML=e,t.innerText.replace(/\n/g," ")}(i);const r="<url>".concat(g(e,t.name),"</url> - ")+"<dim>".concat(g(e,i),"</dim>");n.push({content:i,description:r,deletable:!0})})});const r=setInterval(()=>{n.length===i.getSnippetCount()&&(clearInterval(r),t(n))},100)},this.getFolderSelectList=function(e){let t,n=o.t.new("div"),i=o.t.new("p").html(Object(o.l)(this.name)),r=!1;return i.dataset.name=this.name,n.appendChild(i),this.name!==c.MAIN_SNIPPETS_NAME&&n.addClass("collapsed"),this.forEachFolder(o=>{o.name!==e&&(r=!0,(t=o.getFolderSelectList(e)).style.marginLeft="15px",n.appendChild(t))},!0),r||n.addClass("empty"),n},this.getDuplicatedObject=function(){return new c(this.name,this.list,this.timestamp)},this.getUniqueSnippetAtCaretPos=function(e,t){let n,r=Object(i.c)(e),a="",s=null,c=r[t-1],l=t<o.b?t:o.b;for(let e=1;e<=l;e++){a=c+a,c=r[t-1-e],n=this.getUniqueSnip(a);const i=new RegExp("[".concat(Object(o.k)(Data.snipNameDelimiterList),"]"));if(n&&(Data.matchDelimitedWord&&i&&c&&!i.test(c)&&"\n"!==c||(s=n)),s)break}return s},this.createCtxMenuEntry=function(e){let t;this.list.forEach(n=>{t=a.CTX_START[n.type]+n.name,chrome.contextMenus.create({contexts:["editable"],id:t,title:n.name,parentId:e},Object(o.g)()),listOfSnippetCtxIDs.push(t),c.isFolder(n)&&n.createCtxMenuEntry(t)}),0===this.list.length&&(t="Empty folder "+this.name,chrome.contextMenus.create({contexts:["editable"],id:t,title:"Empty folder ",parentId:e},Object(o.g)()),listOfSnippetCtxIDs.push(t))},this.forEachSnippet=b(a.SNIP_TYPE),this.forEachFolder=b(a.FOLDER_TYPE)}function l(e,t){const n=t?"normal-editor":"ql-editor",i=!t,r=o.t.new("DIV").addClass("nav"),a=o.t.new("SPAN").text("Swap editor mode: "),c=o.t.new("P").text("Textarea").addClass(o.e),l=o.t.new("P").text("Styled textbox");this.isCurrModePlain=!0,this.isQuillInitialized=!1,this.quillInitPromise=null,this.$textarea=null,this.$richEditor=null,this.quill=null,c.dataset.containerSelector="textarea",l.dataset.containerSelector=".".concat("rich_editor_container"),c.dataset.editorSelector="textarea",l.dataset.editorSelector=".".concat(n),r.appendChild(a),r.appendChild(c),r.appendChild(l),e.appendChild(r),e.addClass("dualBoxContainer"),this.$textarea=o.t.new("TEXTAREA").addClass([o.e,c.dataset.containerSelector]);const d=o.t.new("DIV").addClass("rich_editor_container");this.$richEditor=o.t.new("DIV"),e.appendChild(this.$textarea),d.appendChild(this.$richEditor),e.appendChild(d),t?(this.$richEditor.addClass(n).attr("contenteditable","true"),this.quillInitPromise=Promise.resolve(null),this.isQuillInitialized=!0):this.quillInitPromise=function(e,t){console.log("[DEBUG] Starting Quill initialization");const n="editor-".concat(Math.random().toString(36).substr(2,9)),o="toolbar-".concat(n),i=document.createElement("div");return i.id=o,i.className="ql-toolbar ql-snow",t.insertBefore(i,e),e.id=n,new Promise(t=>{try{const n=(o=0)=>{if(o>=50)return console.error("[DEBUG] Dependencies not available after maximum retries"),void t(null);if("undefined"==typeof Quill||"undefined"==typeof QuillTableBetter)return console.log("[DEBUG] Waiting for Quill and QuillTableBetter...",o),void setTimeout(()=>n(o+1),100);try{console.log("[DEBUG] Registering table-better module"),Quill.register({"modules/table-better":QuillTableBetter},!0);const n=new Quill(e,{modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block","link"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["table-better","image"],["clean"]]},"table-better":{operationMenu:{items:{unmergeCells:{text:"Unmerge cells"}}},menus:["column","row","merge","table","cell","wrap","delete"],toolbarTable:!0,tableStyles:{width:"100%",height:"auto",table:{width:"100%","border-collapse":"collapse"},cell:{border:"1px solid #000",padding:"8px","min-width":"50px"}}}},theme:"snow",placeholder:"Start typing..."});console.log("[DEBUG] Quill instance created"),t(n)}catch(e){console.error("[DEBUG] Error during Quill initialization:",e),t(null)}};n()}catch(e){console.error("[DEBUG] Error in initializeQuill:",e),t(null)}})}(this.$richEditor,d).then(t=>t?(this.quill=t,this.$richEditor=e.querySelector(l.dataset.editorSelector),this.isQuillInitialized=!0,t):(console.error("[DEBUG] Failed to initialize Quill editor"),null));const u=async t=>{try{this.isQuillInitialized||await this.quillInitPromise;let n,r,a=e.querySelectorAll(".".concat(o.e)),c=a[1];const l=this.isCurrModePlain?this.getPlainText():this.getRichText();let d=null;try{d=JSON.parse(l)}catch(e){}a&&a.length>0&&(a.forEach(e=>e.removeClass(o.e)),c&&c.removeAttribute("tab-index")),t&&(t.addClass(o.e),n=e.querySelector(t.dataset.containerSelector),r=e.querySelector(t.dataset.editorSelector),n&&r&&(n.addClass(o.e),r.attr("tab-index",20),r.focus()));const u=this.isCurrModePlain;this.isCurrModePlain=!u,l&&l.trim()?d&&"quill-table-content"===d.type?this.isCurrModePlain?this.setPlainText(l):this.loadContent(l):i&&(this.isCurrModePlain?u?this.setPlainText(l):this.setPlainText(s.makeHTMLSuitableForTextareaThroughString(l)):this.loadContent(l)):this.isCurrModePlain?this.setPlainText(""):this.loadContent("")}catch(e){return console.error("Error in editor swap:",e),!1}};r.on("click",async e=>{const t=e.detail&&e.detail.target||e.target;if("P"!==t.tagName||t.hasClass(o.e))return!1;const n=this.isCurrModePlain?this.getPlainText():this.getRichText();return console.log("[DEBUG] Current content before trim:",n),(this.isCurrModePlain||""!==n&&"<p><br></p>"!==n&&"<p><br></p><p><br></p>"!==n)&&n&&n.trim()?(console.log("[DEBUG] Editor switch prevented - content present"),!1):u(t)}),this.userAllowsToLoseFormattingOnSwapToTextarea=function(){const e=s.getQuillClsForFormattedLossyContent(this.$richEditor.innerHTML);return!(e&&!window.confirm("We detected formatted text ".concat(e," in your expansion. You will lose it after this swap. Are you sure you wish to continue?")))},this.switchToDefaultView=async function(e){await this.quillInitPromise;const t=s.isSuitableForPastingInTextareaAsIs(e)?c:l;return await u(t),this},this.setPlainText=function(e){if(console.log("[DEBUG] Setting plain text input type:",typeof e),console.log("[DEBUG] Setting plain text input value:",e),!e)return this.$textarea.value="",this;try{let t;if(e&&"object"==typeof e&&e.body){console.log("[DEBUG] Found object with body property"),console.log("[DEBUG] Body type:",typeof e.body),console.log("[DEBUG] Body value:",e.body);try{t=JSON.parse(e.body),console.log("[DEBUG] Successfully parsed body into:",t)}catch(t){console.log("[DEBUG] Error parsing body:",t),console.log("[DEBUG] Failed to parse body:",e.body)}}else if("string"==typeof e){console.log("[DEBUG] Attempting to parse string input");try{t=JSON.parse(e),console.log("[DEBUG] Successfully parsed string into:",t)}catch(t){console.log("[DEBUG] Failed to parse string:",e)}}else console.log("[DEBUG] Using input as is:",e),t=e;if(t&&"quill-table-content"===t.type){console.log("[DEBUG] Found quill-table-content"),console.log("[DEBUG] HTML content:",t.html),console.log("[DEBUG] Delta content:",t.delta);const e=document.createElement("div");let n=t.html;console.log("[DEBUG] Step 1 - Original HTML:",n),n=n.replace(/\\&quot;|&quot;|\\"/g,'"').replace(/\\"([^"]+)\\"/g,'"$1"').replace(/\\n/g,"\n").replace(/class="[^"]*"/g,"").replace(/style="[^"]*"/g,"").replace(/data-[^=]+="[^"]*"/g,"").replace(/width="[^"]*"/g,"").replace(/height="[^"]*"/g,"").replace(/<temporary[^>]*>.*?<\/temporary>/g,"").replace(/<br\/?>/g,"").replace(/<tbody>/g,"").replace(/<\/tbody>/g,""),console.log("[DEBUG] Step 2 - After cleanup:",n),e.innerHTML=n,console.log("[DEBUG] Step 3 - After setting innerHTML:",e.innerHTML);const o=e.querySelector("table");if(o){console.log("[DEBUG] Found table element:",o.outerHTML);const e=Array.from(o.querySelectorAll("tr"));if(console.log("[DEBUG] Found rows:",e.length),console.log("[DEBUG] Row elements:",e.map(e=>e.outerHTML)),0===e.length)return console.log("[DEBUG] No rows found in table"),this;const t=e.map((e,t)=>{console.log("[DEBUG] Processing row ".concat(t," HTML:"),e.innerHTML);const n=Array.from(e.querySelectorAll("td"));return console.log("[DEBUG] Found ".concat(n.length," cells in row ").concat(t)),n.map((e,n)=>{const o=e.querySelector("p");console.log("[DEBUG] Cell [".concat(t,",").concat(n,"] HTML:"),e.innerHTML),console.log("[DEBUG] Cell [".concat(t,",").concat(n,"] p element:"),o?o.outerHTML:"none");const i=(o?o.textContent:e.textContent).trim();return console.log("[DEBUG] Cell [".concat(t,",").concat(n,"] extracted content:"),i),i||" "})});console.log("[DEBUG] Final extracted table data:",t);const n=[];for(let e=0;e<t[0].length;e++)n[e]=Math.max(3,...t.map(t=>(t[e]||"").length)),console.log("[DEBUG] Column ".concat(e," width:"),n[e]);const i=Math.max(...n);n.fill(i),console.log("[DEBUG] Using consistent width for all columns:",i);let r="\n";const a="+"+n.map(e=>"-".repeat(e+2)).join("+")+"+\n";return console.log("[DEBUG] Separator line:",a),r+=a,t.forEach((e,t)=>{const o="|"+e.map((e,t)=>" "+e.padEnd(n[t])+" ").join("|")+"|\n";console.log("[DEBUG] Row ".concat(t," ASCII:"),o),r+=o+a}),console.log("[DEBUG] Final ASCII table:",r),this.$textarea.value=r,this}console.log("[DEBUG] No table element found in cleaned HTML")}else console.log("[DEBUG] Content is not quill-table-content:",t);if(t&&t.html){console.log("[DEBUG] Handling as regular HTML content");const e=document.createElement("div");return e.innerHTML=t.html,this.$textarea.value=e.textContent.trim(),this}if(t&&t.delta&&t.delta.ops){console.log("[DEBUG] Handling as delta content"),console.log("[DEBUG] Delta ops:",t.delta.ops);const e=t.delta.ops.map(e=>e.insert||"").join("").trim();return console.log("[DEBUG] Extracted text from delta:",e),this.$textarea.value=e,this}}catch(e){console.log("[DEBUG] Error in setPlainText:",e),console.log("[DEBUG] Error stack:",e.stack)}return console.log("[DEBUG] Falling back to plain text handling"),this.$textarea.value="string"==typeof e?e:String(e),this},this.getShownTextForSaving=async function(){if(console.log("[DEBUG] getShownTextForSaving called"),await this.quillInitPromise,this.isCurrModePlain)return s.sanitizeTextareaTextForSave(this.$textarea.value);if(!this.quill)return console.error("[DEBUG] Quill not initialized"),"";const e=this.quill.root.innerHTML,t=this.quill.getContents();return JSON.stringify({type:"quill-table-content",html:e,delta:t})}}function d(e){const t=["push","pop","shift","unshift","splice"];for(const n of t)Object.defineProperty(e,n,{configurable:!1,enumerable:!1,writable:!1,value:function(t){return function(...n){const o=[][t].apply(e,n);return c.setIndices(),o}}(n)})}a.HIGHLIGHTING_CLASS="highlighting",a.FOLDER_TYPE="folder",a.SNIP_TYPE="snip",a.CTX_START={},a.CTX_START[a.SNIP_TYPE]="".concat(a.SNIP_TYPE,"_"),a.CTX_START[a.FOLDER_TYPE]="".concat(a.FOLDER_TYPE,"_"),a.CTX_SNIP_REGEX=new RegExp(a.CTX_START[a.SNIP_TYPE]),a.prototype.getDOMElement=function(e){e=void 0===e?[]:Array.isArray(e)?e:[e];const t=o.t.new("div").addClass([this.type,"generic",s.DOMContractedClass]),n=o.t.new("img");n.src="../imgs/".concat(this.type,".svg"),t.appendChild(n);const i=o.t.new("div").html(Object(o.l)(this.name)).addClass("name");return i.dataset.name=this.name,t.appendChild(i),t.appendChild(this.getButtonsDOMElm()),e.indexOf(this.name)>-1&&(!1!==e[0]&&t.removeClass(s.DOMContractedClass),t.addClass(a.HIGHLIGHTING_CLASS),setTimeout(()=>{t.removeClass(a.HIGHLIGHTING_CLASS)},3e3)),t},a.prototype.getButtonsDOMElm=function(){const e=document.createElement("div");e.className="buttons";const t=document.createElement("div");t.classList.add("edit_btn"),t.classList.add("panel_btn"),t.title="Edit";const n=document.createElement("div");n.classList.add("delete_btn"),n.classList.add("panel_btn"),n.title="Delete";const o=document.createElement("div");return o.classList.add("clone_btn"),o.classList.add("panel_btn"),o.title="Clone",e.appendChild(t),e.appendChild(n),e.appendChild(o),e},a.prototype.preventButtonClickOverride=function(e){return function(t){t.target.matches(".buttons, .buttons div")||e.call(this,t)}},a.prototype.getDuplicateObjectsText=function(e,t){return"A ".concat(t," with name '").concat(e,"' already exists (possibly with the same letters in upper/lower case.)")},a.prototype.isValidName=function(e,t){if(0===e.length)return"Empty name field";if(e.length>o.b)return"Name cannot be greater than ".concat(o.b," characters. Current name has ").concat(e.length-o.b," more characters.");try{return Data.snippets.getUniqueObject(e,t)?a.getDuplicateObjectsText(e,t):"true"}catch(e){return"true"}},a.prototype.getObjectThroughDOMListElm=function(e){const t=e.classList.contains("snip")?a.SNIP_TYPE:a.FOLDER_TYPE,{name:n}=e.qClsSingle("name").dataset;return Data.snippets.getUniqueObject(n,t)},s.prototype=new a,s.MAX_COLLAPSED_CHARACTERS_DISPLAYED=200,s.DOMContractedClass="contracted",s.PASTE_MACRO_REGEX=/\[\[%p\]\]/gi,s.CARET_POSITION_CLASS="caretPlacement",s.CARET_POSITION_EMPTY_REGEX=/\[\[%c(\(\))?\]\]/,s.CARET_POSITION_STUFFED_REGEX=/\[\[%c\([v^<>\d]+\)\]\]/,s.CARET_POSITION_SELECTION_START_REGEX=/\[\[%c\(s\)\]\]/,s.CARET_POSITION_SELECTION_END_REGEX=/\[\[%c\(e\)\]\]/,s.CARET_POSITION_SELECTION_END_STRING="[[%c(e)]]",s.fromObject=function(e){const t=new s(e.name,e.body);return t.timestamp=e.timestamp?"number"==typeof e.timestamp?e.timestamp:Date.parse(e.timestamp.substring(11)):Date.now(),t},s.isValidName=function(e){const t=a.isValidName(e,a.SNIP_TYPE);return/^%.+%$/.test(e)?"Name cannot be of the form '%abc%'":t},s.isValidBody=function(e){return e.length?"true":"Empty body field"},s.getTimestampString=function(e){return"Created on ".concat(Object(r.d)(e.timestamp))},s.makeHTMLSuitableForTextareaThroughString=function(e){const t=document.createElement("div");return t.innerHTML=e,s.makeHTMLSuitableForTextarea(t)},s.makeHTMLSuitableForTextarea=function(e){console.log("[DEBUG] makeHTMLSuitableForTextarea input:",e.innerHTML);try{if(e.innerHTML.includes("quill-table-content")){console.log("[DEBUG] Found table content");const t=document.createElement("div");t.innerHTML=e.innerHTML;const n=t.querySelector("table");if(n){console.log("[DEBUG] Found table element:",n.outerHTML);const e=Array.from(n.querySelectorAll("tr"));if(console.log("[DEBUG] Found rows:",e.length),0===e.length)return console.log("[DEBUG] No rows found"),"";const t=e.map((e,t)=>(console.log("[DEBUG] Processing row ".concat(t,":"),e.innerHTML),Array.from(e.querySelectorAll("td")).map((e,n)=>{const o=e.querySelector("p"),i=(o?o.textContent:e.textContent).trim();return console.log("[DEBUG] Cell [".concat(t,",").concat(n,"] content:"),i),i||" "})));console.log("[DEBUG] Table data:",t);const o=[];for(let e=0;e<t[0].length;e++)o[e]=Math.max(3,...t.map(t=>(t[e]||"").length));let i="\n";const r="+"+o.map(e=>"-".repeat(e+2)).join("+")+"+\n";return i+=r,t.forEach(e=>{i+="|"+e.map((e,t)=>" "+e.padEnd(o[t])+" ").join("|")+"|\n"+r}),console.log("[DEBUG] ASCII table:",i),i}const o=e.innerHTML.match(/"delta":\s*({[^}]+})/);if(o){console.log("[DEBUG] Found delta content");try{const e=JSON.parse(o[1]);if(e.ops){const t=e.ops.map(e=>e.insert&&"object"==typeof e.insert&&e.insert.image?"[Pictures cannot be displayed in plain-text boxes.]":e.insert||"").join("").trim();return console.log("[DEBUG] Extracted text from delta:",t),t}}catch(e){console.log("[DEBUG] Error parsing delta:",e)}}}function t(e){const t=e.tagName.toLowerCase(),n=["<".concat(t,">"),"</".concat(t,">")];return"a"===t&&(n[0]="<a href='".concat(e.href,"'>")),"span"!==t?n:["",""]}function n(e){if(Object(o.r)(e))return e.textContent;let i,r,a,s,c,{tagName:l}=e,d="",u=e.childNodes,p=0,h=u.length;if("IMG"===l)return"[Pictures cannot be displayed in plain-text boxes.]";if("PRE"===l)return(r=t(e))[0]+e.innerHTML+r[1];if("P"===l&&1===h){if(c=(s=u[0]).innerText||s.textContent,"BR"===s.tagName)return"";if(0===c.length)return""}for(;p<h;p++)1===(i=u[p]).nodeType?(a=(r=t(i))[0]+n(i)+r[1],"LI"===i.tagName?d+="    ".concat(a,"\n"):d+=a):d+=i.textContent;switch(l){case"BLOCKQUOTE":return"<blockquote>".concat(d,"</blockquote>");case"OL":return"<ol>\n".concat(d,"</ol>");case"UL":return"<ul>\n".concat(d,"</ul>");case"TABLE":return"<table>".concat(d,"</table>");case"TR":return"<tr>".concat(d,"</tr>");default:return d}}console.log("[DEBUG] Handling as regular HTML");let i,r,a=e.childNodes,s="",c=a.length,l=0;for(;l<c;)s+="<!!>"===(r=n(i=a[l]))?"":"".concat(r,"\n"),l++;return s=(s=s.replace(/&nbsp;/g," ")).substring(0,s.length-1),console.log("[DEBUG] Final output:",s),s}catch(e){return console.log("[DEBUG] Error in makeHTMLSuitableForTextarea:",e),console.log("[DEBUG] Error stack:",e.stack),""}},s.isSuitableForPastingInTextareaAsIs=function(e){return!(s.hasFormattedLossyContentWoQuillCls(e)||/<p>|<br>/.test(e))},s.hasFormattedLossyContentWoQuillCls=function(e){const t=[/background-color: /,/color: /,/text-align: /,/font-size: /,/font-family: /];for(let n=0,o=t.length;n<o;n++)if(t[n].test(e))return!0;return!1},s.getQuillClsForFormattedLossyContent=function(e){const t=[[/ql-font/,"font"],[/ql-align/,"alignment"],[/ql-size/,"size"],[/color: /,"color"],[/background-color: /,"background color"]];for(let n=0,o=t.length;n<o;n++)if(t[n][0].test(e))return t[n][1];return null},s.stripAllTags=function(e,t){t||(t=o.t.new("DIV")),e&&(t.innerHTML=e);const{tagName:n}=t;switch(n){case"DIV":case"OL":case"UL":break;default:return t.innerText.replace(/\n/g," ")}const i=t.childNodes,r=i.length;let a="",c=0;if(0===r)return t.innerText.replace(/\n/g," ");for(;c<r;c++)a+="".concat(s.stripAllTags("",i[c]),"\n");return a},s.defaultLinkSanitize=function(e){return e=e.replace(/^chrome-extension:\/\/[a-z]+\/html\//,""),/^\w+:/.test(e)||/^https?:/.test(e)||(e="http:".concat(e)),e},s.formatOLULInListParentForTextarea=Object(i.a)("    ","\n"),s.sanitizeTextareaTextForSave=function(e){const t=o.t.new("div");return t.innerHTML=e,t.innerHTML=t.innerHTML.replace(/&nbsp;/g," "),t.querySelectorAll("a").forEach(e=>{e.href=s.defaultLinkSanitize(e.href)}),t.querySelectorAll("ol, ul").forEach(s.formatOLULInListParentForTextarea),t.innerHTML},s.validate=function(e,t,n){let i,r,l=["name","body","timestamp"],d=l.length,u={body:s.isValidBody,name:s.isValidName},p="".concat(n,"th snippet under folder ").concat(t);if(Array.isArray(e)){if("true"!==(r=c.validate(e)))return r}else{if(!Object(o.p)(e))return"".concat(p," is not an object.");{let t=0;for(const n of Object.keys(e)){if(-1===l.indexOf(n)){delete e[n];continue}t++,i=e[n];const o=u[n];if(o&&("true"!==(r=o(i))&&a.getDuplicateObjectsText(i,a.SNIP_TYPE)!==r))return"Invalid value for property ".concat(n," in ").concat(p,"; received error: ").concat(r)}if(t!==d)return"".concat(p," is missing one of the properties: ").concat(JSON.stringify(l))}}return"true"},c.prototype=new a,c.fromArray=function(e){"string"!=typeof e[0]&&e.unshift(c.MAIN_SNIPPETS_NAME),"number"!=typeof e[1]&&e.splice(1,0,Date.now());const t=new c(e.shift(),void 0,e.shift());return t.list=e.map(e=>Array.isArray(e)?c.fromArray(e):s.fromObject(e)),window.IN_OPTIONS_PAGE&&d(t.list),t},c.isValidName=function(e){return a.isValidName(e,a.FOLDER_TYPE)},c.isFolder=function(e){return e&&e.type===a.FOLDER_TYPE},c.makeFolderIfList=function(e){e&&Array.isArray(e.snippets)&&(e.snippets=c.fromArray(e.snippets))},c.makeListIfFolder=function(e){c.isFolder(e.snippets)&&(e.snippets=e.snippets.toArray())},c.MAIN_SNIPPETS_NAME="Snippets",c.SEARCH_RESULTS_NAME="Search Results in ",c.CHEVRON_TEXT="<<",c.setIndices=function(){function e(e,t,n){c.indices[e][t.toLowerCase()]=n}c.indices={},c.indices[a.FOLDER_TYPE]={},c.indices[a.SNIP_TYPE]={},!1!==Data.snippets&&function t(n,o){let i,r=0;e(n.type,n.name,o),n.list.forEach(n=>{i=o.concat(r),c.isFolder(n)?t(n,i):e(n.type,n.name,i),r++})}(Data.snippets,[])},c.copyContents=function(e,t){const{list:n}=e;for(let e=n.length-1;e>=0;e--)c.insertObject(n[e].getDuplicatedObject(),t)},c.insertObject=function(e,t){c.isFolder(e)?t.list.unshift(e):t.list.splice(t.getLastFolderIndex()+1,0,e)},c.insertBulkActionDOM=function(e){const t=o.t.new("div");return e.list.forEach(e=>{const n=o.t.new("div").addClass("generic"),i=o.t.new("input"),r=o.t.new("img"),a=o.t.new("div").addClass("name").html(Object(o.l)(e.name));a.dataset.name=e.name,i.type="checkbox",r.src="../imgs/".concat(e.type,".svg"),n.appendChild(i),n.appendChild(r),n.appendChild(a),t.appendChild(n)}),$containerSnippets.html("").appendChild(t),t},c.getSelectedFolderInSelectList=function(e){const t=e.qClsSingle("selected").dataset.name;return Data.snippets.getUniqueFolder(t)},c.refreshSelectList=function(e){e.html("").appendChild(Data.snippets.getFolderSelectList()),e.children[0].children[0].addClass("selected")},c.implementChevronInFolderPath=function(e){const t=15;const n=$containerFolderPath.offsetWidth,o=function(){let e=0,n=[].slice.call($containerFolderPath.children,0).reduce((t,n)=>n.hasClass("right_arrow")?(e++,t):t+n.offsetWidth,0);return n+=e*t}(),i=$containerFolderPath.lastChild.previousElementSibling,r=c.getListedFolder();if(o>n){const e=$containerFolderPath.querySelector(".path_part:not(.chevron)");if(e===i)e.style.width="".concat($containerFolderPath.offsetWidth-t-50,"px"),e.addClass("ellipsized");else{const t=!!$containerFolderPath.querySelector(".chevron");$containerFolderPath.removeChild(e.nextElementSibling),t?$containerFolderPath.removeChild(e):e.addClass("chevron").html(c.CHEVRON_TEXT),c.implementChevronInFolderPath(!0)}}else!e&&$containerFolderPath.querySelector(".chevron")&&r.insertFolderPathDOM()},c.getListedFolderName=function(){return $containerFolderPath.querySelector(":nth-last-child(2)").dataset.name},c.getListedFolder=function(){let e=c.getListedFolderName();return-1!==e.indexOf(c.SEARCH_RESULTS_NAME)&&(e=e.substring(c.SEARCH_RESULTS_NAME.length)),Data.snippets.getUniqueFolder(e)},c.validate=function(e){"string"!=typeof e[0]&&(e.unshift(Date.now()),e.unshift(c.MAIN_SNIPPETS_NAME));const t=e[0],n=e[1],o=e.slice(2),i="Folder ".concat(t);let r;if("string"!=typeof t)return"Name of ".concat(i," is not a string.");const l=c.isValidName(t);if("true"!==l&&a.getDuplicateObjectsText(t,a.FOLDER_TYPE)!==l)return"Name of ".concat(i," is invalid because: ").concat(l);if("number"!=typeof n)return"Timestamp for ".concat(i," is not a number");for(let e,n=0,i=o.length;n<i;n++)if(e=o[n],"true"!==(r=s.validate(e,t,n)))return r;return"true"},c.getDefaultSnippetData=function(){const e=Date.now(),t=new c(c.MAIN_SNIPPETS_NAME,[],e);return t.list=[new c("sampleFolder",[],e),new s("sampleSnippet","Hello new user! Thank you for using DotExpander!\n\nThis is a sample snippet. Try using it on any webpage by typing 'sampleSnippet' (snippet name; without quotes), and press the hotkey (default: Shift+Space), and this whole text would come in place of it.",e),new s("letter","(Sample snippet to demonstrate the power of DotExpander snippets; for more detail on Placeholders, see the Help section)\n\nHello %name%,\n\nYour complaint number %complaint% has been noted. We will work at our best pace to get this issue solved for you. If you experience any more problems, please feel free to contact at me@organization.com.\n\nRegards,\n%my_name%,\nDate: [[%d(D-MM-YYYY)]]",e),new s("brb","be right back",e),new s("my_sign","<b>DotExpander &#169;</b>\n<i>Created by DoctorDurant LLC</i>\n<u>james@doctordurant.com</u>",e),new s("dateArithmetic","Use this snippet in any webpage, and you'll see that the following: [[%d(Do MMMM YYYY hh:m:s)]] is replaced by the current date and time.\n\nMoreover, you can perform date/time arithmetic. The following: [[%d(D+5 MMMM+5 YYYY+5 hh-5:m-5:s-5)]] gives the date, month, year, forward by five; and hour, minutes, and seconds backward by 5.\n\nMore info on this in the Help section.",e),new s("urlMacro","Use the URL macro (details in the Help page) to retrieve parts of the URL of the active webpage. For example, [[%u(host)]] gives the hostname.",e),new s("README-New_UI_Details","Dear user, here are some things you need to know in this new UI:\n\n1. You need to click on the name or body of the listed snippet to expand it completely. In the following image, the purple area shows where you can click to expand the snippet.\n\n<img src='../imgs/help1.png'>\n\n2. Click on the pencil icon to edit and the dustbin icon to delete a snippet/folder.\n3. Click on the folder, anywhere in the purple area denoted below, to view its contents.\n\n<img src='../imgs/help2.png'>\n\n4. Click on a folder name in the navbar to view its contents. In the example below, the navbar consists of 'Snippets', 'sampleFolder' and 'folder2',  each nested within the previous.\n\n<img src='../imgs/help3.png'>",e),new s("clipboard_macro","Use this snippet anywhere and the following - [[%p]] - will be replaced by  your clipboard data. Clipboard data includes text that you have previously copied or cut with intention to paste.",e)],t},l.prototype.getPlainText=function(){return this.$textarea.value},l.prototype.getRichText=function(){return this.quill&&this.quill.getLength()<=1?"":this.$richEditor.innerHTML},l.prototype.setRichText=async function(e){if(console.log("[DEBUG] Setting rich text:",e),!this.isQuillInitialized&&this.quillInitPromise&&(console.log("[DEBUG] Waiting for Quill initialization"),await this.quillInitPromise),this.quill){try{if(this.isCurrModePlain&&e&&"object"==typeof e&&"quill-table-content"===e.type){console.log("[DEBUG] Auto-switching to rich text mode for table content");const e=document.querySelector(".nav p:not(.show)");e&&(e.click(),await new Promise(e=>setTimeout(e,100)))}this.loadContent(e)}catch(e){console.error("[DEBUG] Error in setRichText:",e),this.quill.setText("")}return this}console.error("[DEBUG] Quill not available")},l.prototype.loadContent=function(e){console.log("[DEBUG] Loading content:",e);try{if(!this.quill)return void console.error("[DEBUG] Quill not initialized");let t,n=e;if("string"==typeof e&&e.trim())try{n=JSON.parse(e)}catch(e){console.log("[DEBUG] Content is not JSON structured")}const o=e=>e&&(e.includes("<table")||e.includes("</table>")||e.includes("<td")||e.includes("</td>")||e.includes("<th")||e.includes("</th>"));if(n&&"object"==typeof n){if("quill-table-content"===n.type&&n.html)if(o(n.html))if(console.log("[DEBUG] Loading structured table content with HTML:",n.html),n.delta&&n.delta.ops){console.log("[DEBUG] Using stored delta"),t=new(this.quill.constructor.import("delta"))(n.delta.ops)}else console.log("[DEBUG] Converting HTML to delta"),t=this.quill.clipboard.convert(n.html);else console.log("[DEBUG] Content marked as table but no table found - treating as regular content"),t=this.quill.clipboard.convert(n.html);else if(n.ops){console.log("[DEBUG] Using provided delta"),t=new(this.quill.constructor.import("delta"))(n.ops)}}else"string"==typeof n&&(console.log("[DEBUG] Converting HTML/text content"),t=this.quill.clipboard.convert(n));if(!t||!t.ops||!t.ops.length){console.log("[DEBUG] No valid delta content, creating empty delta"),t=(new(this.quill.constructor.import("delta"))).insert("\n")}console.log("[DEBUG] Final delta to apply:",t),this.quill.setText(""),this.quill.updateContents(t,Quill.sources.USER),this.quill.focus(),this.quill.setSelection(0,0),console.log("[DEBUG] Content loaded successfully")}catch(e){console.error("[DEBUG] Error loading content:",e),this.quill.setText("")}},s.getPreviewText=function(e){try{const t="string"==typeof e?JSON.parse(e):e;if(t&&"quill-table-content"===t.type)return t.html.replace(/<table[^>]*>/g,"\n[Table Start]\n").replace(/<\/table>/g,"\n[Table End]\n").replace(/<tr[^>]*>/g,"").replace(/<\/tr>/g,"\n").replace(/<td[^>]*>/g,"| ").replace(/<\/td>/g," ").replace(/<p[^>]*>/g,"").replace(/<\/p>/g,"").replace(/<br\/?>/g,"\n").replace(/<[^>]+>/g,"").replace(/\n{3,}/g,"\n\n").trim()}catch(e){}return e},s.makeHTMLValidForExternalEmbed=function(e,t){if(console.log("[DEBUG] makeHTMLValidForExternalEmbed input:",e),console.log("[DEBUG] Raw input length:",e.length),console.log("[DEBUG] Input newline count:",(e.match(/\n/g)||[]).length),!e)return console.log("[DEBUG] makeHTMLValidForExternalEmbed: empty input"),"";let n=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n{3,}/g,"\n\n").trim();console.log("[DEBUG] After newline normalization:",n),console.log("[DEBUG] Normalized newline count:",(n.match(/\n/g)||[]).length);const i=o.t.new("div");if(n=n.replace(new RegExp("<span[^>]*".concat(s.CARET_POSITION_CLASS,"[^>]*>"),"g"),""),console.log("[DEBUG] After caret removal:",n),!n.includes("<p>")){console.log("[DEBUG] Converting newlines to paragraphs");let e=n.split(/\n\s*\n/).filter(e=>e.trim());console.log("[DEBUG] Paragraph count after split:",e.length),n=(n="<p>"+e.join("</p><p>")+"</p>").replace(/\n/g,"<br>"),console.log("[DEBUG] After paragraph conversion:",n)}i.innerHTML=n,console.log("[DEBUG] Container HTML after initial set:",i.innerHTML),console.log("[DEBUG] Paragraph elements count:",i.querySelectorAll("p").length),console.log("[DEBUG] BR elements count:",i.querySelectorAll("br").length),i.querySelectorAll("table").forEach((e,t)=>{console.log("[DEBUG] Processing table ".concat(t+1)),e.setAttribute("style","border-collapse: collapse !important; width: 100% !important; border: 1px solid black !important; margin-bottom: 10px !important;"),e.className=e.className.replace(/dotexpander-table/g,"")+" dotexpander-table";const n=e.querySelectorAll("td, th");console.log("[DEBUG] Table ".concat(t+1," cell count:"),n.length)});const r=i.querySelectorAll("p");let a=0;r.forEach(e=>{e.innerHTML;e.innerHTML=e.innerHTML.replace(/\s+/g," ").trim(),e.innerHTML&&"<br>"!==e.innerHTML&&"&nbsp;"!==e.innerHTML||(e.remove(),a++)}),console.log("[DEBUG] Removed empty paragraphs count:",a);let c=i.innerHTML.replace(/>\s+</g,"><").replace(/\s+/g," ").trim();return console.log("[DEBUG] Final HTML length:",c.length),console.log("[DEBUG] Final paragraph count:",(c.match(/<p>/g)||[]).length),console.log("[DEBUG] Final BR count:",(c.match(/<br>/g)||[]).length),console.log("[DEBUG] Final processed HTML:",c),c}},function(e,t,n){"use strict";function o(){this.matchesUnique=function(e){return this.name.toLowerCase()===e.toLowerCase()},this.matchesNameLazy=function(e){return new RegExp(e,"i").test(this.name)},this.matchesLazy=function(e){return new RegExp(e,"i").test(this.name+this.strippedBody)},this.matchesWord=function(e){return new RegExp("\\b".concat(e,"\\b"),"i").test(this.name+this.strippedBody)},this.remove=function(e){const t=e.getUniqueObjectIndex(this.name,this.type),n=t[t.length-1];this.getParentFolder(e).list.splice(n,1),r.setIndices(e)},this.getParentFolder=function(e){let t=e.getUniqueObjectIndex(this.name,this.type),n=e;for(let e=0;e<t.length-1;e++)n=n.list[t[e]];return n}}function i(e,t,n){this.name=e||"",this.body=t||"",this.timestamp=n||Date.now(),this.type=o.SNIP_TYPE}function r(e,t,n){this.name=e||"",this.type=o.FOLDER_TYPE,this.timestamp=n||Date.now(),this.list=Array.isArray(t)?t:[]}n.d(t,"a",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"b",function(){return o}),o.FOLDER_TYPE="folder",o.SNIP_TYPE="snip",i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.toJSON=function(){return{type:this.type,name:this.name,body:this.body,timestamp:this.timestamp}},i.fromObject=function(e){if(!e||!e.name)return null;const t=new i(e.name,e.body);return t.timestamp=e.timestamp?"number"==typeof e.timestamp?e.timestamp:Date.parse(e.timestamp.substring(11)):Date.now(),t},r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype.getUniqueObjectIndex=function(e,t){if(!e||!t)return[];const n=[];for(let i=0;i<this.list.length;i++){const r=this.list[i];r&&r.matchesUnique&&r.matchesUnique(e)&&r.type===t&&(n.push(i),r.type===o.FOLDER_TYPE&&n.push(...r.getUniqueObjectIndex(e,t)))}return n},r.prototype.listSnippets=function(){const e=[],t=n=>{n&&(n.type===o.SNIP_TYPE?e.push(n):n.type===o.FOLDER_TYPE&&Array.isArray(n.list)&&n.list.forEach(t))};return this.list.forEach(t),e},r.prototype.toJSON=function(){return{type:this.type,name:this.name,timestamp:this.timestamp,list:this.list.map(e=>e instanceof r||e instanceof i?e.toJSON():e)}},r.MAIN_SNIPPETS_NAME="Snippets",r.SEARCH_RESULTS_NAME="Search Results in ",r.indices={[o.FOLDER_TYPE]:{},[o.SNIP_TYPE]:{}},r.setIndices=function(e){function t(e,t,n){t?r.indices[e][t.toLowerCase()]=n:console.warn("[SET_INDICES] Attempted to set index with empty name:",{type:e,indexArray:n})}r.indices={[o.FOLDER_TYPE]:{},[o.SNIP_TYPE]:{}},e&&function e(n,i){if(!n||!n.list)return void console.warn("[SET_INDICES] Invalid folder in repeat:",n);let r=0;t(n.type,n.name,i),n.list.forEach(n=>{if(!n||!n.type)return void console.warn("[SET_INDICES] Invalid list item:",n);const a=i.concat(r);n.type===o.FOLDER_TYPE?e(n,a):t(n.type,n.name,a),r++})}(e,[])},r.fromObject=function(e,t=!1){if(!e)return null;const n=new r(t?r.MAIN_SNIPPETS_NAME:e.name,[],e.timestamp);return e.list&&Array.isArray(e.list)&&e.list.forEach(e=>{if(e.type===o.FOLDER_TYPE){const t=r.fromObject(e);t&&n.list.push(t)}else if(e.type===o.SNIP_TYPE){const t=i.fromObject(e);t&&n.list.push(t)}}),n},r.fromArray=function(e,t=!1){if(!e||!Array.isArray(e))return null;let n,a,s;t||"r"===e[0]||e[0]===r.MAIN_SNIPPETS_NAME?("r"===e[0]?[,a,...s]=e:e[0]===r.MAIN_SNIPPETS_NAME?[,a,...s]=e:[a,...s]=e,n=r.MAIN_SNIPPETS_NAME):[n,a,...s]=e;const c=new r(n,[],a);return c.type=o.FOLDER_TYPE,s.forEach(e=>{if(Array.isArray(e))if(e.length>2){const t=r.fromArray(e);t&&c.list.push(t)}else{const[t,n]=e,r=new i(t,"",n);r.type=o.SNIP_TYPE,c.list.push(r)}else if("object"==typeof e)if("r"===e.type||"a"===e.type||e.type===o.FOLDER_TYPE){const t=new r(e.name,[],e.timestamp);t.type=o.FOLDER_TYPE,e.list&&e.list.forEach(e=>{if("r"===e.type||"a"===e.type||e.type===o.FOLDER_TYPE){const n=r.fromObject(e);n&&t.list.push(n)}else{const n=i.fromObject(e);n&&t.list.push(n)}}),c.list.push(t)}else{const t=i.fromObject(e);t&&c.list.push(t)}}),c},r.getDefaultSnippetData=function(){const e=Date.now(),t=new r(r.MAIN_SNIPPETS_NAME,[],e);return t.list=[new r("sampleFolder",[],e),new i("sampleSnippet","Hello new user! Thank you for using DotExpander!\n\nThis is a sample snippet. Try using it on any webpage by typing 'sampleSnippet' (snippet name; without quotes), and press the hotkey (default: Shift+Space), and this whole text would come in place of it.",e),new i("letter","(Sample snippet to demonstrate the power of DotExpander snippets; for more detail on Placeholders, see the Help section)\n\nHello %name%,\n\nYour complaint number %complaint% has been noted. We will work at our best pace to get this issue solved for you. If you experience any more problems, please feel free to contact at me@organization.com.\n\nRegards,\n%my_name%,\nDate: [[%d(D-MM-YYYY)]]",e),new i("brb","be right back",e),new i("my_sign","<b>DotExpander &#169;</b>\n<i>Created by DoctorDurant LLC</i>\n<u>james@doctordurant.com</u>",e),new i("dateArithmetic","Use this snippet in any webpage, and you'll see that the following: [[%d(Do MMMM YYYY hh:m:s)]] is replaced by the current date and time.\n\nMoreover, you can perform date/time arithmetic. The following: [[%d(D+5 MMMM+5 YYYY+5 hh-5:m-5:s-5)]] gives the date, month, year, forward by five; and hour, minutes, and seconds backward by 5.\n\nMore info on this in the Help section.",e),new i("urlMacro","Use the URL macro (details in the Help page) to retrieve parts of the URL of the active webpage. For example, [[%u(host)]] gives the hostname.",e)],t}},function(e,t,n){"use strict";n.d(t,"b",function(){return f}),n.d(t,"j",function(){return b}),n.d(t,"h",function(){return E}),n.d(t,"g",function(){return y}),n.d(t,"i",function(){return p}),n.d(t,"f",function(){return c}),n.d(t,"c",function(){return d}),n.d(t,"d",function(){return u}),n.d(t,"e",function(){return l}),n.d(t,"a",function(){return g});n(0);var o=n(1),i=n(5);const r=e=>{if(e===o.c.FOLDER_TYPE||e===o.c.SNIP_TYPE)return e;return{r:o.c.FOLDER_TYPE,o:o.c.SNIP_TYPE,a:o.c.FOLDER_TYPE,i:o.c.SNIP_TYPE,folder:o.c.FOLDER_TYPE,snip:o.c.SNIP_TYPE}[e]||e};function a(e){var t;if(console.log("[SERIALIZE_SNIPPET_DATA] Input:",{type:null==e?void 0:e.type,name:null==e?void 0:e.name,listLength:null==e||null===(t=e.list)||void 0===t?void 0:t.length,isInstance:e instanceof o.b}),!e)return null;const n=r(e.type),i={type:n,name:e.name,timestamp:e.timestamp};var s;n===o.c.FOLDER_TYPE?i.list=null===(s=e.list)||void 0===s?void 0:s.map(e=>a(e)).filter(Boolean):n===o.c.SNIP_TYPE&&(i.body=e.body);return i}function s(e){var t;if(console.log("[DESERIALIZE_SNIPPET_DATA] Input:",{type:null==e?void 0:e.type,name:null==e?void 0:e.name,listLength:null==e||null===(t=e.list)||void 0===t?void 0:t.length,isPlainObject:(null==e?void 0:e.constructor)===Object}),!e)return null;const n=r(e.type);if(n===o.c.FOLDER_TYPE){const t=new o.b(e.name,[],e.timestamp);return e.list&&Array.isArray(e.list)&&(t.list=e.list.map(e=>s(e)).filter(Boolean)),t}return n===o.c.SNIP_TYPE?new o.d(e.name,e.body||"",e.timestamp):null}const c={snippets:o.b.getDefaultSnippetData(),blockedSites:[],charsToAutoInsertUserList:[["(",")"],["{","}"],['"','"'],["[","]"]],dataVersion:1,language:"English",hotKey:["shiftKey","Tab"],dataUpdateVariable:!0,matchDelimitedWord:!0,tabKey:!1,snipNameDelimiterList:" @#$%&*+-=(){}[]:\"'/_<>?!.,",omniboxSearchURL:"https://www.google.com/search?q=SEARCH",wrapSelectionAutoInsert:!0,ctxEnabled:!0,dotPhrasesEnabled:!0,darkMode:!1},l="UserSnippets",d="prokeys_revisions",u="pkStorageType";function p(e){let t=JSON.parse(localStorage[d]);const n={label:"".concat(Object(i.d)()," - ").concat(window.latestRevisionLabel),data:e||Data.snippets};t.unshift(n),t=t.slice(0,20);let o=!0;for(;o;)try{localStorage[d]=JSON.stringify(t),o=!1}catch(e){o=!0,t.pop()}}const h=window.location.href&&/chrome-extension:\/\//.test(window.location.href);function f(e){console.log("[CDH] Requesting data from service worker");try{chrome.runtime.sendMessage({giveData:!0},async t=>{if(console.log("[CDH] Received raw data:",t),t.error)throw console.error("[CDH] Error getting data:",t.error),new Error(t.error);t.snippets&&(console.log("[CDH] Deserializing snippets"),t.snippets=s(t.snippets),console.log("[CDH] Deserialized snippets:",t.snippets),console.log("[CDH] snippets instanceof Folder:",t.snippets instanceof o.b)),e&&e(t)})}catch(e){throw console.error("[CDH] Error in DBget:",e),e}}function m(e){console.log("[CDH] Updating data:",Data),console.log("[CDH] Data.snippets instanceof Folder:",Data.snippets instanceof o.b);try{Data.snippets&&(console.log("[CDH] Ensuring proper instances before update"),Data.snippets=ensureProperInstances(Data.snippets),console.log("[CDH] Prepared snippets:",Data.snippets),console.log("[CDH] snippets instanceof Folder:",Data.snippets instanceof o.b));const t={...Data,snippets:a(Data.snippets)};chrome.runtime.sendMessage({updateData:t},t=>{if(console.log("[CDH] Update response:",t),t.error)throw console.error("[CDH] Error updating data:",t.error),new Error(t.error);e&&e(t)})}catch(e){throw console.error("[CDH] Error in DBupdate:",e),e}}async function g(e){var t,n;console.log("[DB_SAVE] Starting save with data:",{hasData:!!Data,hasSnippets:!(null===(t=Data)||void 0===t||!t.snippets),isSnippetsFolder:(null===(n=Data)||void 0===n?void 0:n.snippets)instanceof o.b});try{if(!Data||!Data.snippets)throw new Error("Invalid data structure");o.b.makeListIfFolder(Data),Data.dataUpdateVariable=!Data.dataUpdateVariable;const t=await chrome.runtime.sendMessage({type:"updateStorage",data:{key:l,value:Data}});if(console.log("[DB_SAVE] Storage update response:",t),null!=t&&t.success){if(o.b.makeFolderIfList(Data),e)try{e()}catch(e){console.error("[DB_SAVE] Callback error:",e)}}else console.error("[DB_SAVE] Failed to update storage:",null==t?void 0:t.error)}catch(e){console.error("[DB_SAVE] Error during save:",e),o.b.makeFolderIfList(Data)}}function b(e,t,n){console.log("[SAVE_SNIPPET_DATA] Starting save:",{hasCallback:!!e,folderNameToList:t,objectNamesToHighlight:n});try{!Data.snippets||Data.snippets instanceof o.b||(console.log("[SAVE_SNIPPET_DATA] Converting data to proper instances"),Data.snippets=ensureProperInstances(Data.snippets)),g(()=>{try{h?(console.log("[SAVE_SNIPPET_DATA] Updating UI in options page"),chrome.runtime.sendMessage({getData:!0},t=>{console.log("[SAVE_SNIPPET_DATA] Got fresh data:",{hasData:!!t,hasSnippets:!(null==t||!t.snippets)}),null!=t&&t.snippets?(Data=t,Data.snippets=s(t.snippets),window.$containerSnippets?(window.$containerSnippets.html(""),Data.snippets&&"function"==typeof Data.snippets.listSnippets?Data.snippets.listSnippets(n):console.error("[SAVE_SNIPPET_DATA] Data.snippets is not properly initialized")):console.warn("[SAVE_SNIPPET_DATA] Container not found"),Data.snippets instanceof o.b&&o.b.setIndices(Data.snippets)):console.error("[SAVE_SNIPPET_DATA] No snippets in response:",t),e&&e()})):e&&e()}catch(e){if(console.error("[SAVE_SNIPPET_DATA] Error in save callback:",e),h&&window.$containerSnippets&&Data.snippets)try{Data.snippets.listSnippets()}catch(e){console.error("[SAVE_SNIPPET_DATA] Failed to recover UI:",e)}}})}catch(e){console.error("[SAVE_SNIPPET_DATA] Error during save:",e)}}function E(e="Saved!",t){m(()=>{"function"==typeof e?e():"string"==typeof e&&window.alert(e),t&&t()})}function y(e,t){const n=Data.snippets.toArray();Data.snippets=!1,m(()=>{chrome.runtime.sendMessage({changeStorageType:!0,overridingSync:e},o=>{if(!1===o.completed)return Data.snippets=n,void m(()=>{t(!1)});e?(Data.snippets=n,m(()=>t(!0))):t&&t(!0)})})}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a});var o=n(0);const i={};function r(e,t,n){n.Array.prototype[e]=n.NodeList.prototype[e]=n.HTMLCollection.prototype[e]=function(...e){for(let n=0,o=this.length;n<o;n++)t.apply(this[n],e);return this},n.Node.prototype[e]=t}function a(e){for(const[t,n]of Object.entries(i))r(t,n,e);e[o.c]=!0}function s(e,t){i[e]=t}},function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"e",function(){return c}),n.d(t,"f",function(){return s}),n.d(t,"d",function(){return p}),n.d(t,"b",function(){return r}),n.d(t,"a",function(){return h});const o=["January","February","March","April","May","June","July","August","September","October","November","December"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=864e5;function a(){const e=new Date,t=Number.padNumber(e.getHours()),n=Number.padNumber(e.getMinutes()),o=Number.padNumber(e.getSeconds());return"".concat(t,":").concat(n,":").concat(o)}function s(e){return e%4==0&&e%100!=0||e%400==0}function c(e){const t=new Date,n=Math.abs(e),o=e<0,i=o?1:-1;let r=0,a=t.getMonth(),c=t.getFullYear(),l=0;for(;l<=n;){switch((a+=i)>11?(a=0,c++):a<0&&(a=11,c--),a){case 0:case 2:case 4:case 6:case 7:case 9:case 11:r++;break;case 1:r--,s(c)||r--}l++}return o?-r:r}function l(e){return 0===e?[12,"am"]:12===e?[12,"pm"]:e>=1&&e<12?[e,"am"]:[e-12,"pm"]}function d(e,t){return"full"===t?i[e]:i[e].slice(0,3)}function u(e,t){return"full"===t?o[e]:o[e].slice(0,3)}function p(e){return(e?new Date(e):new Date).toString().substring(4,15)}const h=[["s([+-]\\d+)?",[function(e){return Number.padNumber(e.getSeconds())},1e3]],["\\bm([+-]\\d+)?\\b",[function(e){return Number.padNumber(e.getMinutes())},6e4]],["hh([+-]\\d+)?",[function(e){return Number.padNumber(e.getHours())},36e5]],["h([+-]\\d+)?",[function(e){return Number.padNumber(l(e.getHours())[0])},36e5]],["\\ba\\b",[function(e){return l(e.getHours())[1]},r]],["Do([+-]\\d+)?",[function(e){return function(e){const t=e%10;let n="th";return 1===t&&11!==e?n="st":2===t&&12!==e?n="nd":3===t&&13!==e&&(n="rd"),e+n}(e.getDate())},r]],["D([+-]\\d+)?",[function(e){return Number.padNumber(e.getDate())},r]],["dddd([+-]\\d+)?",[function(e){return d(e.getDay(),"full")},r]],["ddd([+-]\\d+)?",[function(e){return d(e.getDay(),"half")},r]],["MMMM([+-]\\d+)?",[function(e){return u(e.getMonth(),"full")},30*r]],["MMM([+-]\\d+)?",[function(e){return u(e.getMonth(),"half")},30*r]],["MM([+-]\\d+)?",[function(e){return Number.padNumber(e.getMonth()+1)},30*r]],["YYYY([+-]\\d+)?",[function(e){return e.getFullYear()},365*r]],["YY([+-]\\d+)?",[function(e){return e.getFullYear()%100},365*r]],["ZZ",[function(e){return e.toString().match(/\((.*)\)/)[1]},0]],["Z",[function(e){return e.toString().match(/\((.*)\)/)[1].split(" ").reduce((e,t)=>e+t[0],"")},0]],["z",[function(e){return e.toString().match(/GMT(.*?) /)[1]},0]],["J",[function(e){return e.getDayOfYear()},0]],["date",[p,0]],["time",[a,0]]]},function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"e",function(){return r}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return s});const o={ENABLED:!1,OBJECT_NAME_LIMIT:50},i={SHOW_CLASS:"show",PRIMITIVES_EXT_KEY:"primitivesExtended"},r={BLOCKED_PATTERNS:[/^chrome-extension:/,/^chrome:/,/^https?:\/\/chrome\.google\.com/,/^about:blank/,/^www\./i]},a={MODIFIER_KEYS:["Control","Alt","Shift","Meta"],SPECIAL_KEYS:{ENTER:13,ESC:27,SPACE:32,TAB:9}},s={ANIMATION_DURATION:300,DEFAULT_DEBOUNCE_DELAY:250}},function(e,t,n){"use strict";n.d(t,"d",function(){return c}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return a}),n.d(t,"a",function(){return i});var o=n(0);function i(e,t){return function(n){let o=t;n.Q("li").forEach(n=>{o+="".concat(e,"<li>").concat(n.innerHTML,"</li>").concat(t)}),n.innerHTML=o}}const r=i("","");function a(e){return s(e,"innerText")}function s(e,t){if(e){if(Object(o.r)(e))return e.textContent.replace(/\u00a0/g," ");switch(e.tagName){case"TEXTAREA":case"INPUT":return e.value;default:return e[t||"innerHTML"]}}}function c(e,t,n,i){if(t=t.toString(),Object(o.r)(e))return e.textContent=t.replace(/ /g,""),e;switch(e.tagName){case"TEXTAREA":case"INPUT":e.value=t.replace("<br>","\n").replace("&nbsp;"," ");break;default:if("innerText"===n)e.innerText=t.replace("<br>","\n").replace("&nbsp;"," ");else try{e.innerHTML=t.replace(/ $/g,"&nbsp;").replace(/ {2}/g," &nbsp;"),i?function(e){const t=e.childNodes.filter(e=>Object(o.r)(e)),n=t.length;let i,a,s,c,l,d,u,p=0;for(;p<n;p++){for(s=0,c=(a=(i=t[p]).textContent.split(/\n/g)).length;s<c;s++)u=a[s],l=document.createTextNode(u),d=o.t.new("br"),e.insertBefore(d,i),e.insertBefore(l,d);e.removeChild(d),e.removeChild(i)}e.Q("pre, blockquote, ol, ul").forEach(e=>{const t=e.nextElementSibling;t&&"BR"===t.tagName&&t.parentNode.removeChild(t)}),e.Q("ol, ul").forEach(r)}(e):e.innerHTML=e.innerHTML.replace(/\n/g,"<br>")}catch(e){console.log("From setHTML: `node` argment is undefined")}}return e}},function(e,t,n){"use strict";n.d(t,"d",function(){return o}),n.d(t,"c",function(){return i}),n.d(t,"f",function(){return r}),n.d(t,"e",function(){return a}),n.d(t,"b",function(){return s}),n.d(t,"a",function(){return c});n(2);const o=102400,i=5242880,r={snippets:null,blockedSites:[],charsToAutoInsertUserList:[["(",")"],["{","}"],['"','"'],["[","]"]],dataVersion:1,language:"English",hotKey:["shiftKey","Tab"],dataUpdateVariable:!0,matchDelimitedWord:!0,tabKey:!1,snipNameDelimiterList:" @#$%&*+-=(){}[]:\"'/_<>?!.,",omniboxSearchURL:"https://www.google.com/search?q=SEARCH",wrapSelectionAutoInsert:!0,ctxEnabled:!0,dotPhrasesEnabled:!0},a="UserSnippets",s="storageType",c="revisions"},,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),i=n(4),r=n(7),a=n(5);function s(){Date.prototype.isLeapYear=function(){const e=this.getFullYear();return Object(a.f)(e)},Date.prototype.getDayOfYear=function(){const e=this.getMonth(),t=this.getDate();let n=[0,31,59,90,120,151,181,212,243,273,304,334][e]+t;return e>1&&this.isLeapYear()&&n++,n},NodeList.prototype.__proto__=Array.prototype,Number.padNumber=function(e){return((e=parseInt(e,10))<=9?"0":"")+e},String.prototype.unsubstring=function(e,t){return this.substring(0,e)+this.substring(t)},Object(i.a)("trigger",function(e,t){const n=new CustomEvent(e,{detail:t||null});this.dispatchEvent(n)}),Object(i.a)("triggerKeypress",function(e){const t=new Event("input");t.keyCode=e,this.dispatchEvent(t)}),Object(i.a)("on",window.on=function(e,t,n){const o=e.split(/,\s*/g);for(const e of o)this.addEventListener(e,t,n);return this}),Object(i.a)("insertAfter",function(e){return this.parentNode.insertBefore(e,this.nextSibling),this}),Object(i.a)("hasClass",function(e){return this.className&&new RegExp("(^|\\s)".concat(e,"(\\s|$)")).test(this.className)}),Object(i.a)("toggleClass",function(e){return this.classList.toggle(e),this}),Object(i.a)("addClass",function(e){return Array.isArray(e)||(e=[e]),e.forEach(e=>{this.classList.add(e)}),this}),Object(i.a)("removeClass",function(e){return Array.isArray(e)||(e=[e]),e.forEach(e=>{this.classList.remove(e)}),this}),Object(i.a)("isTextBox",function(){return"INPUT"===this.tagName||"TEXTAREA"===this.tagName}),Object(i.a)("attr",function(e,t){return void 0!==t?(this.setAttribute(e,t),this):this.getAttribute(e)}),Object(i.a)("parent",function(e){let t=this.parentElement;for(;t;){if(t.matches(e))return t;t=t.parentElement}return null}),Object(i.a)("html",function(e,t,n){return void 0!==e?Object(r.d)(this,e,t,n):Object(r.b)(this,t)}),Object(i.a)("text",function(e){return this.html(e,"innerText")});for(const[e,t]of Object.entries(o.a))Object(i.a)(e,t)}},,,,function(e,t,n){"use strict";n.r(t);var o=n(3),i=n(0),r=n(1);let a,s;function c(e,t){const n="(1)";function o(e){const s=[];e.list.forEach((e,c)=>{(function(e){const s=Data.snippets.getUniqueObject(e.name,e.type),c="both"===a;let l=!1;if(s)switch(a){case"both":!function(e){const t=e.name.length;t<=i.b-n.length?e.name+=n:e.name=e.name.substring(0,t-3)+n}(e);break;case"imported":s.remove();break;case"existing":l=!0}r.b.isFolder(e)&&(o(e),s&&!c&&t&&("imported"===a?r.b.copyContents(s,e):r.b.copyContents(e,s)));return l})(e)&&s.push(c)});let c=s.length-1;for(;c>=0;)e.list.splice(s[c--],1)}o(e)}function l(e,t){!function(e){let t=!1;for(const n of Object.keys(o.f))void 0===e[n]&&(e[n]=o.f[n],t=!0)}(e);const n=r.b.validate(t);if("true"!==n)return n;if("data"!==s)return"true";for(const t of Object.keys(e))Object.prototype.hasOwnProperty.call(o.f,t)||delete e[t];const i=function(e){const t=e.length;for(let n=0;n<t;n++){const o=e[n],i="elements in ".concat(n+1,"th character list");if(!Array.isArray(o))return"Invalid ".concat(i);if(2!==o.length)return"Expected exactly 2 ".concat(i);if("string"!=typeof o[0]||"string"!=typeof o[1])return"".concat(i," are not strings.");if(1!==o[0].length||1!==o[1].length)return"".concat(i," are not of length 1.");for(let i=n+1;i<t;i++)o[0]===e[i][0]&&(e.splice(i,1),i--)}return"true"}(e.charsToAutoInsertUserList);if("true"!==i)return i;for(const[t,n]of e.blockedSites.entries()){if("string"!=typeof n)return"Element ".concat(n," of blocked sites was not a string.");e.blockedSites[t]=n.replace(/^www/,"")}return e.blockedSites=Array.from(new Set(e.blockedSites)),"true"}function d(e,t=null,n=null){const d=Object(i.t)(".panel.import"),u=d.qClsSingle("selectList"),p=t||r.b.getSelectedFolderInSelectList(u),h=d.qClsSingle("delete_existing"),f=n||h.checked,m=d.q("input[name=merge]").checked;let g;a=d.q("input[name=duplicate]:checked").value;try{e=JSON.parse(e)}catch(t){try{e=JSON.parse(function(e){const t=Date.now();let n=[];return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(e=(e+="\n\n").split(/\n\n--\n\n/gm)).forEach(e=>{const o=e.indexOf("\n\n"),i=e.substring(0,o);""!==i&&n.push({name:i,body:e.substring(o+2),timestamp:t})}),n=["Snippets",t].concat(n),n=JSON.stringify(n,null,4)}(e)),console.log("Received print snippets data",e)}catch(t){return window.alert("Data was of incorrect format! Please close this box and check console log (Ctrl+Shift+J/Cmd+Shift+J) for error report. And mail it to us at prokeys.feedback@gmail.com to be resolved."),console.log(t.message),void console.log(e)}}const b="data"===(s=Array.isArray(e)?"snippets":"data")?e.snippets:e,E=l(e,b);if("true"!==E)return void window.alert(E);const y=r.b.fromArray(b);f&&(p.list=[]),r.b.setIndices(),c(y,m),r.b.copyContents(y,p),"data"===s&&(g=r.b.fromArray(Data.snippets.toArray()),Data=e,Data.snippets=g),Object(o.j)(()=>{window.confirm("Data saved! Reload the page for changes to take effect?")&&window.location.reload()})}const u=8192;function p(e){return new Blob([JSON.stringify(e)]).size}async function h(e){try{const t=JSON.parse(localStorage[o.c]||"[]")[e];if(!t)return null;if(t.bodyKey){const{data:e}=await async function(e){try{const t=await chrome.storage.sync.get(e);if(t[e])return{data:t[e],storage:"sync"}}catch(e){console.warn("Failed to retrieve from sync storage: ".concat(e.message))}try{const t=await chrome.storage.sync.get("".concat(e,"_chunks"));if(t["".concat(e,"_chunks")]){const{keys:n}=t["".concat(e,"_chunks")],o=await chrome.storage.sync.get(n),i=n.map(e=>o[e]);return{data:JSON.parse(i.join("")),storage:"chunked"}}}catch(e){console.warn("Failed to retrieve chunked data: ".concat(e.message))}try{const t=await chrome.storage.local.get(e);if(t[e])return{data:t[e],storage:"local"}}catch(e){console.error("Failed to retrieve from local storage: ".concat(e.message))}return{data:null,error:"Data not found in any storage"}}(t.bodyKey);e&&(t.body=e)}return t}catch(e){return console.error("Error retrieving revision:",e),null}}function f(){let e;async function t(){const t=Object(i.t)(".export .steps :first-child input:checked").value,n=Object(i.t)(".export a.text-download"),o=Object(i.t)(".export a.csv-download");if("print"===t)e=function(e){let t="";return e.forEachSnippet(e=>{t+=e.name,t+="\n\n",t+=e.body,t+="\n\n--\n\n"},!1),t}(Data.snippets);else{const n=Data.snippets;Data.snippets=Data.snippets.toArray(),e=JSON.stringify("data"===t?Data:Data.snippets,void 0,2),Data.snippets=n}const r="print"===t?"ProKeys print snippets":"ProKeys ".concat(t),a=p(e);a>u&&console.warn("Large export detected (".concat(a," bytes). Using blob storage.")),Object(i.f)(o,function(e,t=","){let n="";return e.forEachSnippet(e=>{n+="".concat(e.name+t+e.body.replace(/\n/g,"\\n"),"\n")}),n}(Data.snippets),r),Object(i.f)(n,e,r)}Object(i.d)(".export-buttons button").on("click",function(){const e=this.className,n={export:t,import:m,revisions:C};Object(i.t)("#snippets .panel_popup.".concat(e)).addClass(i.e),n[e]()}),Object(i.t)(".export .copy-data-to-clipboard-btn").on("click",()=>{Object(i.h)(e)}),Object(i.d)(".export input").on("change",t);const n=Object(i.t)(".import .file_input"),a=n.nextElementSibling,s=n.html(),c=Object(i.t)(".panel.import"),l=Object(i.t)(".import-data-clipboard-btn");let f=null;function m(){const e=Object(i.t)(".import .selectList");r.b.refreshSelectList(e),n.html("Choose file containing data"),a.value=""}Object(i.t)(".import .restore").on("click",()=>{if(f){Object(i.v)("csv-check-import").checked&&(f=function(e,t=","){const n=o.f,i=e.split("\n");n.snippets=new r.b(r.b.MAIN_SNIPPETS_NAME);for(const e of i){const o=e.split(t),[i,r]=[o[0],o.slice(1).join(t)];""!==i&&""!==r&&n.snippets.addSnip(i,r.replace(/\\n/g,"<br>"))}return n.snippets=n.snippets.toArray(),JSON.stringify(n)}(f)),d(f)}else window.alert("Please choose a file.")}),c.on("paste",e=>{f=e.clipboardData.getData("text"),l.html("Pasted data is ready. Click Restore button to begin.")}),a.on("change",()=>{const e=a.files[0];if(!e)return!1;const t=new FileReader;return t.addEventListener("load",t=>{f=t.target.result,n.html("File '".concat(e.name,"' is READY.")+" Click Restore button to begin. Click here again to choose another file.")}),t.addEventListener("error",e=>{console.error("File '".concat(f.name,"' could not be read! Please send following error to prokeys.feedback@gmail.com ")+" so that I can fix it. Thanks! ERROR: ".concat(e.target.error.code)),n.html(s)}),t.readAsText(e),n.html("READING FILE: ".concat(e.name)),!0});const g=Object(i.t)(".revisions .restore"),b=Object(i.t)(".revisions textarea"),E=Object(i.t)(".revisions select"),y=Object(i.t)(".revisions .close_btn"),w=Object(i.t)(".import .preserve_checkboxes"),S=w.q("[name=merge]"),D=w.q("[value=existing]"),T=w.q("[value=imported]"),v=w.q("p");let O;async function C(){const e=JSON.parse(localStorage[o.c]||"[]");async function t(){const e=await h(E.selectedIndex);e&&(O=e,b.value=JSON.stringify(e.data,void 0,2))}E.html(""),e.forEach(e=>{E.appendChild(i.t.new("option").html(e.label))}),E.on("input",t),await t()}g.on("click",()=>{try{window.confirm("Are you sure you want to use the selected revision?")&&(Data.snippets=r.b.fromArray(JSON.parse(b.value)),function(e){const t=JSON.parse(localStorage[o.c]);t.splice(e,1),localStorage[o.c]=JSON.stringify(t)}(E.selectedIndex),window.latestRevisionLabel="restored revision (labelled: ".concat(O.label,")"),Object(o.j)(()=>{y.click()}))}catch(e){window.alert("Data in textarea was invalid. Close this box and check console log (Ctrl+Shift+J/Cmd+Shift+J) for error report. Or please try again!")}}),w.on("click",()=>{S.checked?v.html(""):D.checked?v.html("<b>Caveat</b>: Unique content of folders with the same name will not be imported."):T.checked?v.html("<b>Caveat</b>: Unique content of existing folders with the same name will be lost."):v.html("")})}let m,g,b,E,y;function w(e){const t=e===r.c.SNIP_TYPE?m:g;return e=e[0].toUpperCase()+e.substr(1).toLowerCase(),async function(){return t(async(t,n,i,a)=>{var s;console.log("[SAVE_HANDLER] Save handler called with:",{oldName:t,name:n,body:(null==i?void 0:i.substring(0,50))+"...",newParentfolder:a?{name:a.name,type:a.type,isFolderInstance:a instanceof r.b,hasListProperty:!!a.list,listLength:null===(s=a.list)||void 0===s?void 0:s.length}:void 0});const c=a?[a.name]:void 0;t?(console.log("[SAVE_HANDLER] Sending edit request:",{snippetId:t,name:n,body:(null==i?void 0:i.substring(0,50))+"...",folderPath:c}),chrome.runtime.sendMessage({type:"editSnippet",data:{snippetId:t,name:n,body:i,folderPath:c}},n=>{console.log("[SAVE_HANDLER] Edit response:",n),n.success?(window.latestRevisionLabel="edited ".concat(e,' "').concat(t,'"'),Object(o.j)(void 0,a?a.name:void 0)):(console.error("[SAVE_HANDLER] Failed to edit snippet:",n.error),alert("Failed to edit snippet: ".concat(n.error)))})):(console.log("[SAVE_HANDLER] Sending create request:",{name:n,body:(null==i?void 0:i.substring(0,50))+"...",folderPath:c}),chrome.runtime.sendMessage({type:"createSnippet",data:{name:n,body:i,folderPath:c}},t=>{console.log("[SAVE_HANDLER] Create response:",t),t.success?(console.log("[SAVE_HANDLER] Snippet created successfully"),window.latestRevisionLabel="created ".concat(e,' "').concat(n,'"'),Object(o.j)(void 0,a?a.name:void 0)):(console.error("[SAVE_HANDLER] Failed to create snippet:",t.error),alert("Failed to create snippet: ".concat(t.error)))}))})}}function S(e){console.log("[DEBUG] Setting up edit panel for type:",e);const t=Object(i.v)("panel_".concat(e,"_edit")),n=w(e),o=t.q(".name input");let a;function s(e,t){const n=e.Q("p");let o=null;for(const e of n)if(e.dataset.name===t){o=e,e.addClass("selected");break}if(o)for(a=o.parent("div");!a.classList.contains("selectList");)a.removeClass("collapsed"),a=a.parent("div")}return t.on("keydown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey)&&n(),27===e.keyCode&&t.qClsSingle("close_btn").click()}),o.on("keydown",e=>{13!==e.keyCode||e.ctrlKey||e.metaKey||n()}),async function(n,a){console.log("[DEBUG] Edit panel handler called",{object:n,isSavingSnippet:a,isEditing:!!n});const c=t.q(".header span"),l=t.q(".folderSelect .selectList"),d=!!n,u="snip"===e,p=Object(i.u)("error");if($panelSnippets.toggleClass(i.e),t.toggleClass(i.e),d?t.removeClass("creating-new"):t.addClass("creating-new"),console.log("[DEBUG] Clearing editor content"),await Promise.all([y.setPlainText(""),y.setRichText("")]),!a&&d||(o.value="",o.dataset.name=""),!a){if(l.html(""),l.appendChild(d&&"folder"===e?Data.snippets.getFolderSelectList(n.name):Data.snippets.getFolderSelectList()),d){s(l,n.getParentFolder().name)}else s(l,r.b.getListedFolderName());if(c.html((d?"Edit ":"Create new ")+e),p&&p.removeClass(i.e),d&&(console.log("[DEBUG] Loading existing content for editing"),o.value=n.name,o.dataset.name=n.name,u)){console.log("[DEBUG] Setting up editor with body:",n.body);try{let e=n.body;!y.isQuillInitialized&&y.quillInitPromise&&(console.log("[DEBUG] Waiting for Quill initialization"),await y.quillInitPromise);let o=!1;if("string"==typeof e&&e.trim())try{const t=JSON.parse(e);t&&("quill-table-content"===t.type||t.ops)&&(o=!0,e=t)}catch(t){o=e.includes("</")||e.includes("/>")}console.log("[DEBUG] Content type detected:",o?"rich text":"plain text");const i=t.querySelectorAll(".nav p")[o?1:0];i.classList.contains("show")||(i.click(),await new Promise(e=>setTimeout(e,100))),o?await y.setRichText(e):y.setPlainText(e)}catch(e){console.error("[DEBUG] Error setting up editor:",e),await y.setPlainText("")}}}}}function D(e){const t=Object(i.v)("panel_".concat(e,"_edit"));async function n(t,n,o){let a;a=t?t.value:await y.getShownTextForSaving(),console.log("Validating text:",a);const s=n(a),c=o||t.nextElementSibling;let l="true"===s;return s===r.c.prototype.getDuplicateObjectsText(a,e)&&t&&t.dataset.name===a&&(l=!0),l?c.removeClass(i.e):c.addClass(i.e).html(s),console.log("Validation result:",{text:a,isTextValid:l,validation:s}),[a,l]}return async function(e){const o=t.q(".name input"),i=t.qClsSingle("selectList"),a=r.b.getSelectedFolderInSelectList(i),s=/snip/.test(t.className);let c,l;console.log("Starting validation for:",{isSnippet:s,selectedFolder:a?{name:a.name,isRoot:a.name===Data.snippets.name}:null}),s?(c=await n(o,e=>r.c.prototype.isValidName(e,r.c.SNIP_TYPE)),l=await n(void 0,e=>e.length?"true":"Empty body field",t.q(".body .error"))):c=await n(o,e=>r.c.prototype.isValidName(e,r.c.FOLDER_TYPE));const d=c[1]&&(!s||l[1]),u=o.dataset.name;if(console.log("Validation complete:",{allValid:d,oldName:u,name:c[0],body:l?l[0]:void 0,selectedFolder:a?{name:a.name,isRoot:a.name===Data.snippets.name}:null}),d){s?b(void 0,!0):E(void 0,!0);const t=a&&a.name!==Data.snippets.name?a:void 0;e(u,c[0],l&&l[0],t)}}}function T(){const e=Object(i.v)("search_btn"),t=Object(i.v)("panel_search"),n=Object(i.t)(".panel_search input[type=text]"),a=Object(i.u)("close_btn"),s=Object(i.t)(".panel_snip_edit .tick_btn"),c=Object(i.t)(".panel_folder_edit .tick_btn"),l=Object(i.d)('.panel_snippets [class^="add_new"]'),d=Object(i.t)(".panel_snippets .sort_btn"),u=Object(i.v)("panel_sort"),p=Object(i.t)(".panel_sort input[type=button]"),h=Object(i.t)(".panel_snippets .checkbox_btn"),f=Object(i.t)(".panel_snippets .panel_bulk_action"),T=Object(i.v)("folder_path"),v=Object(i.u)("selectList");function O(e){e.removeClass(i.e),$panelSnippets.addClass(i.e)}function C(e,n){const o=Object(i.t)(".sub_panel.show");n.addClass(i.e),o&&o.removeClass(i.e);const a=Object(i.t)(".panel_btn.active");e.addClass("active"),a&&a.removeClass("active"),!t.hasClass(i.e)&&r.b.getListedFolder().isSearchResultFolder&&Data.snippets.listSnippets(),$containerSnippets.q('input[type="checkbox"]')&&!f.hasClass(i.e)&&Data.snippets.getUniqueFolder(f.dataset.originalShownFolderName).listSnippets()}m=D(r.c.SNIP_TYPE),g=D(r.c.FOLDER_TYPE),b=S(r.c.SNIP_TYPE),E=S(r.c.FOLDER_TYPE),y=new r.a(Object(i.w)("body-editor")),$containerSnippets.on("click",e=>{const t=e.target;if(console.log("Click event:",e.target),t.classList.contains("edit_btn")||t.classList.contains("delete_btn")||t.classList.contains("clone_btn")){const e=t.closest(".generic");if(!e)return console.log("No parent element found"),!0;if(console.log("Object element found:",e),t.classList.contains("edit_btn")){const t=e.classList.contains("snip")?r.c.SNIP_TYPE:r.c.FOLDER_TYPE,n=e.querySelector(".name").dataset.name,o=Data.snippets.getUniqueObject(n,t);console.log("Editing object:",o),r.b.isFolder(o)?E(o):b(o)}else t.classList.contains("delete_btn")?function(){const e=this.classList.contains("snip"),t=e?r.c.SNIP_TYPE:r.c.FOLDER_TYPE,n=this.querySelector(".name").dataset.name,i=Data.snippets.getUniqueObject(n,t),a=e?"":" (and ALL its contents)";window.confirm("Delete '".concat(n,"' ").concat(t).concat(a,"?"))&&chrome.runtime.sendMessage({type:"deleteSnippet",data:{snippetId:n,type:t}},e=>{if(e.success){window.latestRevisionLabel="deleted ".concat(t,' "').concat(n,'"');const e=this.closest(".list_item");e&&e.remove();const r=i.getParentFolder();Object(o.j)(void 0,r?r.name:void 0)}else console.error("Failed to delete snippet:",e.error),alert("Failed to delete snippet: ".concat(e.error))})}.call(e):t.classList.contains("clone_btn")&&function(){const e=r.c.getObjectThroughDOMListElm(this),t=e.clone();window.latestRevisionLabel="cloned ".concat(e.type,' "').concat(e.name,'"'),Object(o.j)(void 0,t.getParentFolder().name,[e.name,t.name])}.call(e);return!1}return!0}),T.on("click",e=>{const t=e.target;let n,o;t.matches(".chevron")?(o=r.b.getListedFolder()).getParentFolder().listSnippets():(t.matches(".path_part")||t.parentElement.matches(".path_part"))&&(n=t.innerText,(o=Data.snippets.getUniqueFolder(n)).listSnippets())}),a.on("click",function(){const e=this.parent(".panel"),t=e.q(".name input");t&&function(e,t){const n=e.qClsSingle("body"),o=t.value,i=t.dataset.name!==o;if(!n||i)return i;if(""===o)return!1;const r=y.getShownTextForSaving(),a=Data.snippets.getUniqueSnip(o);return!!a&&a.body!==r}(e,t)?window.confirm("You have unsaved edits. Are you sure you wish to leave?")&&O(e):O(e)}),s.on("click",w(r.c.SNIP_TYPE)),c.on("click",w(r.c.FOLDER_TYPE)),v.on("click",function(e){const t=e.target;let n,o;"P"===t.tagName&&((o=t.parentNode).toggleClass("collapsed"),(n=this.qCls("selected"))&&n.removeClass("selected"),t.addClass("selected"))}),d.on("click",()=>{C(d,u)}),p.on("click",()=>{let e=u.q(".sort-dir :checked").parentNode.innerText,t=u.q(".sort-type :checked").parentNode.innerText;const n=e="Descending"===e,i=r.b.getListedFolder();t="Name"===t?"alphabetic":"date",i.sort(t,n),window.latestRevisionLabel='sorted folder "'.concat(i.name,'"'),Object(o.j)(void 0,i.name)}),l.on("click",function(){/snip/i.test(this.className)?b():E()}),e.on("click",()=>{C(e,t),n.html("").focus(),t.hasClass(i.e)||r.b.getListedFolder().listSnippets()}),e.attr("title","Search for folders or snips"),n.on("keyup",Object(i.i)(function(){const e=this.value;r.b.getListedFolder().searchSnippets(e).listSnippets()},150)),function(){let e,t;const n=f.q(".bulk_actions input:first-child"),a=f.q(".bulk_actions input:last-child"),s=f.q(".selection_count input"),c=f.qClsSingle("folderSelect"),l=f.qClsSingle("selectList");function d(){e=(e=t.Q("input:checked")||[]).map(e=>{const t=e.nextElementSibling.nextElementSibling,{name:n}=t.dataset,o=e.nextElementSibling.src.match(/\w+(?=\.svg)/)[0];return Data.snippets.getUniqueObject(n,o)}),f.q(".selection_count span").html(e.length),f.Q(".bulk_actions input").forEach(t=>{t.disabled=!e.length})}h.on("click",function(){let e,n;C(this,f),f.hasClass(i.e)&&(e=r.b.getListedFolderName(),n=Data.snippets.getUniqueFolder(e),t=r.b.insertBulkActionDOM(n),f.dataset.originalShownFolderName=e,t.on("click",e=>{const t=e.target,n=(t.matches(".generic")?t:t.parent(".generic")).children[0];"INPUT"!==t.tagName&&(n.checked=!n.checked),d()}),d(),c.removeClass(i.e))}),s.on("click",()=>{const e=t.Q("input");let n,o=!0;e.some(e=>!e.checked&&(o=!1,!0)),n=!o,e.forEach(e=>{e.checked=n}),d()}),n.on("click",()=>{let t,n,a=!1;if(c.hasClass(i.e)){if(t=(n=r.b.getSelectedFolderInSelectList(l)).name,e.forEach(e=>{e.canNestUnder(n)?(a=!0,e.moveTo(n)):window.alert("Cannot move ".concat(e.type,' "').concat(e.name,'" to "').concat(n.name,'"')+"; as it is the same as (or a parent folder of) the destination folder")}),!a)return;window.latestRevisionLabel="moved ".concat(e.length,' objects to folder "').concat(t,'"'),Object(o.j)(()=>{h.click()},t,e.map(e=>e.name))}else r.b.refreshSelectList(l),c.addClass(i.e)}),a.on("click",()=>{window.confirm("Are you sure you want to delete these ".concat(e.length," items? ")+"Remember that deleting a folder will also delete ALL its contents.")&&(e.forEach(e=>{e.remove()}),window.latestRevisionLabel="deleted ".concat(e.length," objects"),Object(o.j)(()=>{h.click()},r.b.getListedFolderName()))})}();let L=!1;chrome.storage.local.get("extensionUpdated",e=>{(L=!0===e.extensionUpdated)&&(chrome.storage.local.set({extensionUpdated:!1}),Object(i.v)("change-log").classList.add(i.e),Object(i.w)("faded").classList.add(i.e))}),Object(i.t)(".change-log .buttons button").addEventListener("click",()=>{chrome.storage.local.set({extensionUpdated:!1}),Object(i.v)("change-log").classList.remove(i.e),Object(i.w)("faded").classList.remove(i.e),chrome.action.setBadgeText({text:""})}),Data.snippets.listSnippets()}var v=n(7),O=n(4),C=n(11),L=n(8);window.IN_OPTIONS_PAGE=!0,Object(C.a)(),function(){let e,t,n,a,s,c,l,d,u,p;(async function(){console.log("[OPTIONS] Initializing data");try{const e=await chrome.runtime.sendMessage({type:"getData"});if(console.log("[OPTIONS] Service worker response:",e),e){console.log("[OPTIONS] Got data from service worker"),window.Data=e,console.log("[OPTIONS] Setting initial dark mode state:",window.Data.darkMode),document.documentElement.classList.remove("dark-theme"),!0===window.Data.darkMode&&document.documentElement.classList.add("dark-theme");const t=document.querySelector("#darkMode");return t&&(t.checked=!0===window.Data.darkMode),!0}return console.error("[OPTIONS] Failed to get data from service worker"),!1}catch(e){return console.error("[OPTIONS] Error initializing data:",e),!1}})().then(()=>{console.log("[OPTIONS] Data initialized, setting up UI")});const h="`~|\\^",m=chrome.runtime.getManifest().version;window.$containerSnippets=null,window.$panelSnippets=null,window.$containerFolderPath=null;const g={windowLoaded:!1,quillReady:!1,dbLoaded:!1};function b(){return g.windowLoaded&&g.quillReady&&g.dbLoaded}function E(){if(b())try{p&&p.root&&(console.log("[DEBUG] Setting initial content"),p.root.innerHTML='This is a contenteditable or editable div.\nThese editors are generally found in your email client like Gmail, Outlook, etc.<br><br><i>This editor\n<u>supports</u></i><b> HTML formatting</b>. You can use the "my_sign" sample snippet here, and see the effect.')}catch(e){console.error("[DEBUG] Error setting initial content:",e)}else console.log("[DEBUG] Not setting content - waiting for initialization")}const y=function(){return localStorage[o.d]},w=function(){u.value=Data.blockedSites.join("\n")},S=function(e){const t=i.t.new("tr");for(const n of e)t.appendChild(i.t.new("td").html(n));return t},D=function(e){const t=Data.charsToAutoInsertUserList;for(const[n,o]of t.entries())if(e===o[0])return n;return-1},C=function(){if(0===Data.charsToAutoInsertUserList.length)e.html("No Auto-Insert pair currently. Add new:");else{const t=i.t.new("thead"),n=i.t.new("tr");e.html(""),n.appendChild(i.t.new("th").html("Character")),n.appendChild(i.t.new("th").html("Complement")),t.appendChild(n),e.appendChild(t);for(const t of Data.charsToAutoInsertUserList)e.appendChild(S(t.concat("Remove")))}!function(){const t="char_input",n=i.t.new("tr"),o=s("new character"),r=s("its complement");function a(e){const t=i.t.new("td");t.appendChild(e),n.appendChild(t)}function s(e){const n=i.t.new("input").addClass(t).attr("placeholder","Type ".concat(e));return n.type="text",a(n),n.addEventListener("keydown",e=>{13===e.keyCode&&P([o.value,r.value])}),n}a(i.t.new("button").html("Save")),e.appendChild(n)}()},P=function(e){const[t,n]=e,i="Please type exactly one character in ";1===t.length?1===n.length?-1===D(t)?(Data.charsToAutoInsertUserList.push(e),Object(o.h)("Saved auto-insert pair - ".concat(t).concat(n),C)):window.alert('The character "'.concat(t,'" is already present.')):window.alert("".concat(i,"second field.")):window.alert("".concat(i,"first field."))},_=function(){const e=Data.hotKey,t={9:"Tab",13:"Enter",32:"Space",188:", (Comma)",192:"` (Backtick)"},n={shiftKey:"Shift",ctrlKey:"Ctrl",altKey:"Alt",metaKey:"Meta"};let o,i="";var r;return e[1]?(i+="".concat(n[e[0]]," + "),o=e[1]):o=e[0],Number.isInteger(o)?((r=o)>=96&&r<=105&&(i+="NumPad",o-=48),i+=t[o]||String.fromCharCode(o)):i+=" "===o?"Space":o,i},N=function(e){return/(\w+\.)+\w+/.test(e)?(e=e.replace(i.s,""),Object(i.n)(e)?(window.alert("Site ".concat(e," is already blocked.")),!1):e):(window.alert("Invalid form of site address entered."),!1)},A=function(e){const t={MB:6,KB:3,B:0};for(const[n,o]of Object.entries(t)){const t=Math.pow(10,o);if(e>=t)return Math.round(e/t)+n}return e+"B"},I=function(){var e;e=e=>{if(!e||"number"!=typeof e.bytes)return void console.error("[DEBUG] Invalid bytes response:",e);const t=e.bytes,n="sync"===y()?L.d:L.c;console.log("[DEBUG] Storage usage:",{bytesInUse:t,bytesAvailable:n,storageType:y()});const o=Object(i.v)("currentBytes");o&&o.html(function(e,t){const n=A(e),o=Math.round(e/t*100);return"".concat(n," (").concat(o,"%)")}(t,n));const r=Object(i.v)("bytesAvailable");r&&r.html(A(n))},chrome.runtime.sendMessage({getBytesInUse:!0},Object(i.g)(e))},x=function(e){const t="#".concat(e),n=".sidebar .buttons button[data-divid =".concat(e,"]"),o=Object(i.t)("".concat("#content > ",".show")),r=Object(i.t)(".sidebar .buttons .".concat("selected"));"snippets"===e&&Data.snippets.listSnippets(),o&&o.removeClass("show"),Object(i.t)("#content > "+t).addClass("show"),r&&r.removeClass("selected"),Object(i.t)(n).addClass("selected");let{href:a}=window.location,s=a.indexOf("#");-1!==s&&(a=a.substring(0,s)),window.location.href=a+t,document.body.scrollTop=0},j=function(){if(t=Object(i.w)("tabKey"),n=Object(i.w)("ctxEnable"),a=Object(i.w)("dotPhrasesEnabled"),s=Object(i.t)(".snippet_match_whole_word input[type='checkbox']"),c=Object(i.v)("delimiter_list"),e=Object(i.t)(".auto_insert"),l=Object(i.t)("[name='wrapSelectionAutoInsert']"),d=Object(i.t)(".search-provider input[type='text']"),u=Object(i.t)(".blocked-sites textarea"),!t||!n||!u)return void console.error("[ERROR] Critical DOM elements not found:",{$tabKeyInput:t,$ctxEnabledInput:n,$blockSitesTextarea:u});const r=window.location.href;/#\w+$/.test(r)&&!/tryit|symbolsList/.test(r)?x(r.match(/#(\w+)$/)[1]):x("snippets"),function(){const r=Object(i.t)(".delimiter_list input"),a=Object(i.t)(".delimiter_list button");function l(){r.value=Data.snipNameDelimiterList}t.addEventListener("change",function(){Data.tabKey=this.checked,Object(o.h)()}),n.addEventListener("change",function(){Data.ctxEnabled=this.checked,function(){const e={ctxEnabled:Data.ctxEnabled};chrome.runtime.sendMessage(e,Object(i.g)())}(),Object(o.h)()}),u.addEventListener("keydown",e=>{if(13===e.keyCode&&(e.ctrlKey||e.metaKey)){const e=u.value.split("\n"),t=e.length;let n,i,r=0;for(Data.blockedSites=[];r<t;r++){if(n=e[r].trim(),!1===(i=N(n)))return;Data.blockedSites.push(i)}Object(o.h)(w)}}),e.addEventListener("click",e=>{const t=e.target;"BUTTON"===t.tagName?P(function(e){return e.parentNode.parentNode.qCls("char_input").map(e=>e.value)}(t)):"Remove"===Object(v.b)(t)&&function(e){const t=D(e[0]);Data.charsToAutoInsertUserList.splice(t,1),Object(o.h)("Removed auto-insert pair '".concat(e.join(""),"'"),C)}(function(e){return e.parentNode.Q("td").map(e=>e.innerText).slice(0,2)}(t))}),s.addEventListener("change",function(){const e=this.checked;Data.matchDelimitedWord=e,c.classList.toggle(i.e),Object(o.h)()}),r.addEventListener("keyup",function(e){if(13===e.keyCode){const e=function(e){const t=h.length;let n,o=0;for(;o<t;o++)if(n=h.charAt(o),e.match(Object(i.k)(n)))return n;return!0}(this.value);if(!0!==e)return window.alert('Input list contains reserved delimiter "'.concat(e,'". Please remove it from the list. Thank you!')),!0;Data.snipNameDelimiterList=this.value,Object(o.h)()}return!1}),a.addEventListener("click",()=>{window.confirm("Are you sure you want to replace the current list with the default delimiter list?")&&(Data.snipNameDelimiterList=o.f.snipNameDelimiterList,l(),Object(o.h)())}),l()}(),(a=Object(i.t)("#dotPhrasesEnabled")).checked=Data.dotPhrasesEnabled,a.addEventListener("change",()=>{Data.dotPhrasesEnabled=a.checked,Object(o.h)()});const p=Object(i.t)("#darkMode");console.log("[OPTIONS] Setting up dark mode toggle. Initial state:",Data.darkMode),document.documentElement.classList.remove("dark-theme"),!0===Data.darkMode&&document.documentElement.classList.add("dark-theme"),p.checked=!0===Data.darkMode,p.addEventListener("change",()=>{console.log("[OPTIONS] Dark mode toggled to:",p.checked),Data.darkMode=p.checked,Data.darkMode?document.documentElement.classList.add("dark-theme"):document.documentElement.classList.remove("dark-theme"),Object(o.h)()}),T(),function(){const e=Object(i.v)("storageMode");if(e){const t=y()||"sync";[{id:"sync1",label:"Sync With Other Computers Under This Account",value:"sync"},{id:"sync2",label:"This Device Only",value:"sync"}].forEach(n=>{const o=document.createElement("label"),i=document.createElement("input");i.type="radio",i.name="storageMode",i.id=n.id,i.dataset.storagetoset=n.value,i.checked=t===n.value,o.appendChild(i),o.appendChild(document.createTextNode(" "+n.label)),o.appendChild(document.createElement("br")),e.appendChild(o)})}Object(i.v)("storageMode").addEventListener("click",function(e){const t=e.target;"INPUT"===t.tagName&&t.checked&&function(e,t){window.confirm("Migrate data to ".concat(e," storage? It is VERY NECESSARY to take a BACKUP before proceeding."))?Object(o.g)(t,t=>{t?(window.alert("Done! Data migrated to ".concat(e," storage successfully!")),window.location.reload()):(window.alert("It seems the target storage ".concat(e," hasn't loaded yet.\nIn case of sync data, it may be because of Google sync not having finished yet.\nPlease wait at least five minutes and try again.")),window.location.reload())}):this.checked=!1}.call(t,t.dataset.storagetoset,"sync2"!==t.id)})}(),f();const m=Object(i.t)(".hotkey_listener"),g=Object(i.t)(".hotkey_display"),b=Object(i.t)(".change_hotkey");let E=!1,S=null;function O(){g.innerHTML=_()}b.addEventListener("click",function(){E?(E=!1,this.innerHTML="Change hotkey"):(E=!0,S=null,this.innerHTML="Press your hotkey combination",m.value="",m.focus())}),m.addEventListener("keydown",function(e){if(!E)return;e.preventDefault();const t={Shift:"shiftKey",Control:"ctrlKey",Alt:"altKey",Meta:"metaKey"};if(t[e.key])return S=t[e.key],void(this.value=e.key+" + ...");if(S&&e[S]){const t=" "===e.key?"Space":e.key;Data.hotKey=[S,t],Object(o.h)(O),E=!1,b.innerHTML="Change hotkey",this.value="",this.blur()}}),m.addEventListener("keyup",function(e){if(!E)return;const t={Shift:"shiftKey",Control:"ctrlKey",Alt:"altKey",Meta:"metaKey"};t[e.key]&&t[e.key]===S&&(S=null,this.value="")}),O();d&&d.addEventListener("keydown",function(e){13===e.keyCode&&(Data.omniboxSearchURL=this.value,Object(o.h)())}),l&&l.addEventListener("click",()=>{Data.wrapSelectionAutoInsert=l.checked,Object(o.h)()})},k=function(e){console.log("[DEBUG] DB load complete"),console.log("[DEBUG] DataResponse:",e),console.log("[DEBUG] IN_OPTIONS_PAGE:",window.IN_OPTIONS_PAGE),g.dbLoaded=!0,void 0===e&&(console.log("[DEBUG] No data found, initializing defaults"),e={snippets:r.b.getDefaultSnippetData(),tabKey:!0,ctxEnabled:!0,matchDelimitedWord:!1},console.log("[DEBUG] Created default DataResponse:",e)),window.Data=e,Data=e,console.log("[DEBUG] Data object after assignment:",Data),Data.snippets instanceof r.b||(console.log("[DEBUG] Converting snippets to Folder instance"),console.log("[DEBUG] Current Data.snippets:",Data.snippets),Data.snippets=r.b.getDefaultSnippetData(),console.log("[DEBUG] Created new Folder instance:",Data.snippets)),console.log("[DEBUG] Setting folder indices"),r.b.setIndices();try{console.log("[DEBUG] Initializing UI elements"),$panelSnippets=Object(i.v)("panel_snippets"),console.log("[DEBUG] $panelSnippets:",$panelSnippets),$panelSnippets&&($containerSnippets=$panelSnippets.qClsSingle("panel_content"),$containerFolderPath=$panelSnippets.qClsSingle("folder_path"),console.log("[DEBUG] $containerSnippets:",$containerSnippets),console.log("[DEBUG] $containerFolderPath:",$containerFolderPath)),s=Object(i.t)(".snippet_match_whole_word input[type='checkbox']"),t=Object(i.w)("tabKey"),n=Object(i.w)("ctxEnable"),c=Object(i.v)("delimiter_list"),t&&(t.checked=Data.tabKey),n&&(n.checked=Data.ctxEnabled),s&&(s.checked=Data.matchDelimitedWord,Data.matchDelimitedWord&&c&&c.classList.add(i.e)),t&&t.addEventListener("change",function(){Data.tabKey=this.checked,Object(o.h)()}),n&&n.addEventListener("change",function(){Data.ctxEnabled=this.checked,Object(o.h)()}),s&&s.addEventListener("change",function(){Data.matchDelimitedWord=this.checked,c&&(this.checked?c.classList.add(i.e):c.classList.remove(i.e)),Object(o.h)()})}catch(e){console.error("[DEBUG] Error initializing UI:",e)}j(),b()&&E()};document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".button").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.getAttribute("data-action");if("snippets"===t){if(window.Data&&window.Data.snippets)try{showSnippets()}catch(e){console.error("[DEBUG] Error showing snippets:",e)}}else if("about"===t){const e=Object(i.v)("about");e&&e.classList.add("show")}})})});window.addEventListener("load",function(){console.log("[DEBUG] Window load event fired"),g.windowLoaded=!0,function(){window[i.c]||Object(O.b)(window),chrome.storage.onChanged.addListener(I),Object(i.d)("span.version").forEach(e=>{e.innerHTML=m}),Object(i.d)(".sidebar .buttons button").forEach(e=>{e.addEventListener("click",function(){x(this.dataset.divid)})}),function(){function e(e){const t=e.children[1].children;Array.prototype.forEach.call(t,e=>{e.firstElementChild.innerHTML=Object(i.l)(e.firstElementChild.innerHTML)})}Object(i.d)("#help section dt").forEach(e=>{e.addEventListener("click",function(){this.classList.toggle("show")})}),e(Object(i.v)("date-macro-list")),e(Object(i.v)("browser-macro-list"))}(),function(){const e=Object(i.v)("no-db-error");e.q("button").addEventListener("click",()=>{e.removeClass(i.e)})}();const e=document.getElementById("help");e&&e.addEventListener("click",e=>{"dt"===e.target.tagName.toLowerCase()&&e.target.classList.toggle("show")})}(),Object(o.b)(k)}),chrome.storage.onChanged.addListener(I),document.addEventListener("DOMContentLoaded",()=>{I()})}()}]);