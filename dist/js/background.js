!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(t,e,n){"use strict";n.d(e,"t",function(){return l}),n.d(e,"u",function(){return c}),n.d(e,"v",function(){return u}),n.d(e,"w",function(){return d}),n.d(e,"d",function(){return p}),n.d(e,"q",function(){return r}),n.d(e,"g",function(){return a}),n.d(e,"a",function(){return s}),n.d(e,"p",function(){return h}),n.d(e,"r",function(){return f}),n.d(e,"b",function(){return m}),n.d(e,"s",function(){return b}),n.d(e,"j",function(){return D}),n.d(e,"e",function(){return S}),n.d(e,"c",function(){return T}),n.d(e,"k",function(){return w}),n.d(e,"o",function(){return C}),n.d(e,"i",function(){return v}),n.d(e,"h",function(){return x}),n.d(e,"n",function(){return P}),n.d(e,"f",function(){return O}),n.d(e,"l",function(){return A}),n.d(e,"m",function(){return L}),n.d(e,"x",function(){return I});var o=n(5),i=n(6);function r(t){return t&&t.id&&t.url&&!i.e.BLOCKED_PATTERNS.some(e=>e.test(t.url))}function a(t){const e=function(){let t;try{throw new Error("")}catch(e){t=e.stack||""}return(t=t.split("\n").map(t=>t.trim())).splice("Error"===t[0]?2:1)}().join("\n");return function(...n){chrome.runtime.lastError&&(console.log("CRLError: ".concat(chrome.runtime.lastError.message)),console.log(e)),t&&t(...n)}}const s={q(t){return(this||document).querySelector(t)},Q(t){return(this||document).querySelectorAll(t)},qId(t){return(this||document).getElementById(t)},qCls(t){return[...(this||document).getElementsByClassName(t)]},qClsSingle(t){const e=(this||document).qCls(t);return e?e[0]:null}},{q:l,qCls:c,qClsSingle:u,qId:d,Q:p}=s;function h(t){return"[object Object]"===Object.prototype.toString.call(t)}function f(t){return 3===t.nodeType}l.new=function(t){return document.createElement(t)};const g=i.a.ENABLED,m=i.a.OBJECT_NAME_LIMIT,b=i.e.BLOCKED_PATTERNS[4];let E,y;g?(y=console.log.bind(console),E=console.dir.bind(console)):(y=function(){},E=function(){});const D=y,S=i.b.SHOW_CLASS,T=i.b.PRIMITIVES_EXT_KEY;function w(t){return t.replace(/[-[\]/{}())*+?.\\^$|]/g,"\\$&")}function C(t,e){const n=t&&t.tagName;if(!t||"TEXTAREA"===n||"INPUT"===n||!t.getAttribute)return!1;let o;const i=t.attr?t.attr("contenteditable"):null;if(""===i||"true"===i||"plaintext-only"===i)return!0;if(e)return!1;o=t;do{if(!(o=o.parentNode))return!1;if(C(o,!0))return!0}while(o!==window.document);return!1}function v(t,e=i.d.DEFAULT_DEBOUNCE_DELAY,n){let o;return function(...i){const r=this,a=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||t.apply(r,i)},e),a&&t.apply(r,i)}}function x(t){const e=document.createElement("textarea");e.style.position="fixed",e.style.top=0,e.style.left=0,e.style.width="2em",e.style.height="2em",e.style.padding=0,e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent",e.value=t,document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(e)}function P(t){const e=t.replace(b,"");for(const t of Data.blockedSites){if(new RegExp("^".concat(w(t))).test(e))return!0}return!1}function O(t,e,n){const r=new Blob([e],{type:"text/js"});t.href=i.e.createObjectURL(r),t.download="".concat(n," ").concat(Object(o.d)(),".txt")}function A(t){return"<span class=notranslate>".concat(t,"</span>")}function L(t){return t.ownerDocument.defaultView}function I(t){t.dispatchEvent(new Event("input",{cancelable:!0,bubbles:!0}))}},function(t,e,n){"use strict";n.d(e,"b",function(){return l}),n.d(e,"d",function(){return s}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return c});var o=n(0),i=n(7),r=n(5);function a(){this.matchesUnique=function(t){return this.name.toLowerCase()===t.toLowerCase()},this.matchesNameLazy=function(t){return new RegExp(t,"i").test(this.name)},this.matchesLazy=function(t){return new RegExp(t,"i").test(this.name+this.strippedBody)},this.matchesWord=function(t){return new RegExp("\\b".concat(t,"\\b"),"i").test(this.name+this.strippedBody)},this.remove=function(){const t=Data.snippets.getUniqueObjectIndex(this.name,this.type),e=t[t.length-1];this.getParentFolder().list.splice(e,1),l.setIndices()},this.getParentFolder=function(){let t=Data.snippets.getUniqueObjectIndex(this.name,this.type),e=Data.snippets;for(let n=0,o=t.length-1;n<o;n++)e=e.list[t[n]];return e},this.moveTo=function(t){const e=this.getDuplicatedObject();return this.remove(),l.insertObject(e,t),e},this.canNestUnder=function(t){if(l.isFolder(this))for(;t.name!==l.MAIN_SNIPPETS_NAME;){if(this.name===t.name)return!1;t=t.getParentFolder()}return!0},this.getClone=function(){if(this.type===a.SNIP_TYPE)return new s(this.name,this.body,this.timestamp);const t=new l(this.name,[],this.timestamp);return this.list.forEach(e=>{t.list.push(e.getClone())}),t},this.insertAdjacent=function(t,e,n){const o=this.name,i=this.type,r=Data.snippets.getUniqueObjectIndex(o,i),a=r[r.length-1]+(e?+e:1)*(n?0:1);this.getParentFolder().list.splice(a,0,t),l.setIndices()}}function s(t,e,n){this.name=t,this.body=e,this.timestamp=n||Date.now(),this.type=a.SNIP_TYPE,this.edit=function(t,e){this.name=t;try{if("string"==typeof e&&e.startsWith("{")){const t=JSON.parse(e);if(t&&("quill-table-content"===t.type||"html"===t.type))return void(this.body=e)}}catch(t){console.log("Error parsing body JSON:",t)}this.body=JSON.stringify({type:"html",html:e,delta:null})},this.getDOMElement=function(t){const e=a.prototype.getDOMElement.call(this,t),n=e.qClsSingle("name"),i=o.t.new("div").addClass("body");function r(t){const o=function(t){try{if("string"==typeof t&&t.trim().startsWith("{")){const e=JSON.parse(t);if(e&&e.html)return"quill-table-content"===e.type?e.html.replace(/<table/g,'<table class="dotexpander-table"').replace(/<td/g,'<td class="prokeys-cell"').replace(/<th/g,'<th class="prokeys-cell"'):e.html}}catch(t){console.log("Content is not JSON, using as plain text")}return"<div>".concat(String(t).replace(/\n/g,"<br>"),"</div>")}(t.body);if(e.hasClass(s.DOMContractedClass)){const t=o.replace(/\<[^\>]+\>/g," ").replace(/\s+/g," ").replace(/&[^;]+;/g," ").trim().substring(0,s.MAX_COLLAPSED_CHARACTERS_DISPLAYED);i.text(t),setTimeout(()=>{i.style.width="calc(100% - 100px - ".concat(n.clientWidth,"px)")},1)}else i.html(o).style.width=""}e.appendChild(i),e.appendChild(o.t.new("div").addClass("clickable").on("click",a.prototype.preventButtonClickOverride(()=>{e.toggleClass(s.DOMContractedClass),r(this)}))),r(this);const l=o.t.new("div").addClass("timestamp").html(s.getTimestampString(this));return e.appendChild(l),e},this.getDuplicatedObject=function(){return new s(this.name,this.body,this.timestamp)},this.toArray=function(){return{name:this.name,body:this.body,timestamp:this.timestamp}},this.formatMacros=function(t){const e=[this.name],n={};function i(t,e,n,o){const i=(t=t.replace(new RegExp("^\\".concat(o)),"")).split(new RegExp("\\".concat(e),"g")).slice(0,n).join(e);return i?o+i:""}function a(t,e,n,o){return t.replace(new RegExp("^\\".concat(o)),"").split(e)[n-1]}let l=function t(o){return o.replace(/\[\[%s\((.*?)\)\]\]/g,(o,i)=>{if(e.indexOf(i)>-1)return o;const r=Data.snippets.getUniqueSnip(i),a=r&&r.name;return r?(e.push(a),n[a]?n[a]:(n[a]=t(r.body),n[a])):o})}(this.body);l=(l=(l=l.replace(/\[\[%d\((!?)(.*?)\)\]\]/g,(t,e,n)=>{let o,i,a,s,l,c,u=new Date,d=n;function p(t,n){let o=0;n?(n=parseInt(n,10),/M/.test(a)&&(o+=Object(r.e)(n)*r.b),o+=l*n):a=a.replace(/[^a-zA-Z\\/]/g,"").replace("\\d",""),e&&u.setTime(u.getTime()+o),c=e?u:new Date(Date.now()+o),d=d.replace(new RegExp(a),s(c))}e=!!e;for(const t of r.a)o=t,[a,[s,l]]=o,i=new RegExp(a,"g"),n.replace(i,p);return d})).replace(/\[\[%u\((.*?)\)\]\]/g,(t,e)=>{let n="",o=e.match(/(q?)\d+/),r=e.match(/q(\d+)/);return o=o?o[1]?0:+o[0]:100,r=r?r[1]?+r[1]:100:0,/p/i.test(e)&&(n+="".concat(window.location.protocol,"//")),/w/i.test(e)&&(n+="www."),n+=window.location.host,n+=i(window.location.pathname,"/",o,"/"),n+=i(window.location.search,"&",r,"?"),/h/i.test(e)&&(n+=window.location.hash),n})).replace(/\[\[%u\{(\w|\d+|q\d+)\}\]\]/g,(t,e)=>{let n;return Number.isInteger(+e)?a(window.location.pathname,"/",+e,"/"):"p"===e?window.location.protocol.replace(/:$/,""):"w"===e?"www":"h"===e?(({hash:n}=window.location),n&&n.substring(1)||""):"q"===e[0]?a(window.location.search,"&",+e.substring(1),"?"):""}),s.PASTE_MACRO_REGEX.test(l)?chrome.runtime.sendMessage("givePasteData",Object(o.g)(e=>{t(l.replace(s.PASTE_MACRO_REGEX,e))})):t(l)}}function l(t,e,n,r){function c(t){return function(){return this.list.reduce((e,n)=>n.type===t?e+1:e,0)}}function d(t){return function(e,n,o){const i=t?new s(e,n,o):new l(e,n,o);l.insertObject(i,this),window.latestRevisionLabel="created ".concat(i.type,' "').concat(i.name,'"')}}function p(t){return function(e,n,o){Data.snippets.getUniqueObject(e,t).edit(n,o),window.latestRevisionLabel="edited ".concat(t,' "').concat(e,'"')}}function h(t){return function(e){return this.getUniqueObject(e,t)}}function f(t){return function(e){return this.getUniqueObjectIndex(e,t)}}function g(t){const e=o.t.new("div").addClass("path_part"),n=o.t.new("div").addClass("right_arrow");e.dataset.name=t,$containerFolderPath.appendChild(e.html(Object(o.l)(t))),$containerFolderPath.appendChild(n)}function m(t,e){return e.replace(new RegExp(Object(o.k)(t),"ig"),t=>"<match>".concat(t,"</match>"))}function b(t){const e=function(n,o){this.list.forEach(i=>{!o&&l.isFolder(i)&&e.call(i,n,!1),i.type===t&&n(i)})};return e}console.log("[DEBUG] Creating new Folder:",{orgName:t,list:e,orgTimestamp:n,isSearchResultFolder:r}),console.log("[DEBUG] IN_OPTIONS_PAGE in Folder constructor:",window.IN_OPTIONS_PAGE),this.name=t,this.type=a.FOLDER_TYPE,this.timestamp=n||Date.now(),this.list=(e||[]).slice(0),this.isSearchResultFolder=!!r,window.IN_OPTIONS_PAGE&&(console.log("[DEBUG] In options page, observing list"),u(this.list)),this.getSnippetCount=c(a.SNIP_TYPE),this.getFolderCount=c(a.FOLDER_TYPE),this.getLastFolderIndex=function(){let t=0,e=this.list.length;for(;t<e&&l.isFolder(this.list[t]);)t++;return t-1},this.addSnip=d(!0),this.editSnip=p(a.SNIP_TYPE),this.addFolder=d(!1),this.editFolder=p(a.FOLDER_TYPE),this.edit=function(t){this.name=t},this.getDOMElement=function(t){return a.prototype.getDOMElement.call(this,t).on("click",a.prototype.preventButtonClickOverride(this.listSnippets.bind(this)))},this.getDOMElementFull=function(t){let e,n,i,r=o.t.new("div"),a=this.list.length;for(let o=0;o<a;o++)n=(e=this.list[o]).getDOMElement(t),r.appendChild(n);return 0===a&&((i=o.t.new("div")).addClass("empty_folder").html(this.isSearchResultFolder?"No matches found":"This folder is empty"),r.appendChild(i)),r},this.getUniqueObject=function(t,e){const n=this.getUniqueObjectIndex(t,e);if(!n)return null;let o=this;for(const t of n)o=o.list[t];return o},this.getUniqueObjectIndex=function(t,e){return l.indices[e][t.toLowerCase()]},this.getUniqueSnip=h(a.SNIP_TYPE),this.getUniqueSnipIndex=f(a.SNIP_TYPE),this.getUniqueFolder=h(a.FOLDER_TYPE),this.getUniqueFolderIndex=f(a.FOLDER_TYPE),this.stripAllSnippetsTags=function(t){t=t||o.t.new("DIV"),this.hasStrippedSnippets=!0,this.list.forEach(e=>{l.isFolder(e)?e.stripAllSnippetsTags(t):e.strippedBody=s.stripAllTags(e.body,t)})},this.searchSnippets=function(t){return t=Object(o.k)(t),this.hasStrippedSnippets||this.stripAllSnippetsTags(),new l(l.SEARCH_RESULTS_NAME+this.name,this.list.reduce((e,n)=>(l.isFolder(n)&&(e=e.concat(n.searchSnippets(t).list)),n.matchesLazy(t)&&e.push(n),e),[]).sort((e,n)=>n.matchesUnique(t)?1:e.matchesUnique(t)?-1:n.matchesNameLazy(t)?1:!e.matchesNameLazy(t)&&n.matchesWord(t)?1:-1),void 0,!0)},this.sort=function(t,e){const n="alphabetic"===t,o=this.getLastFolderIndex()+1,i=this.list.slice(0,o),r=this.list.slice(o);function a(t){return t.sort((t,e)=>{const o=t.name.localeCompare(e.name);return n?o:t.timestamp-e.timestamp||o}),e?t.reverse():t}this.list=a(i).concat(a(r))},this.listSnippets=function(t){t=Object(o.p)(t)?void 0:t,$containerSnippets.html("").appendChild(this.getDOMElementFull(t)),this.insertFolderPathDOM()},this.insertFolderPathDOM=function(){if($containerFolderPath.html(""),this.isSearchResultFolder)return void g(this.name);g(l.MAIN_SNIPPETS_NAME);let t=Data.snippets.getUniqueFolderIndex(this.name),e=Data.snippets;for(const n of t)g((e=e.list[n]).name);l.implementChevronInFolderPath()},this.toArray=function(){return[this.name,this.timestamp].concat(this.list.map(t=>t.toArray()))},this.filterSnippetsForOmnibox=function(t,e){const n=[],i=this.searchSnippets(t);i.forEachSnippet(e=>{e.formatMacros(i=>{i=function(t){const e=o.t.new("div");return e.innerHTML=t,e.innerText.replace(/\n/g," ")}(i);const r="<url>".concat(m(t,e.name),"</url> - ")+"<dim>".concat(m(t,i),"</dim>");n.push({content:i,description:r,deletable:!0})})});const r=setInterval(()=>{n.length===i.getSnippetCount()&&(clearInterval(r),e(n))},100)},this.getFolderSelectList=function(t){let e,n=o.t.new("div"),i=o.t.new("p").html(Object(o.l)(this.name)),r=!1;return i.dataset.name=this.name,n.appendChild(i),this.name!==l.MAIN_SNIPPETS_NAME&&n.addClass("collapsed"),this.forEachFolder(o=>{o.name!==t&&(r=!0,(e=o.getFolderSelectList(t)).style.marginLeft="15px",n.appendChild(e))},!0),r||n.addClass("empty"),n},this.getDuplicatedObject=function(){return new l(this.name,this.list,this.timestamp)},this.getUniqueSnippetAtCaretPos=function(t,e){let n,r=Object(i.c)(t),a="",s=null,l=r[e-1],c=e<o.b?e:o.b;for(let t=1;t<=c;t++){a=l+a,l=r[e-1-t],n=this.getUniqueSnip(a);const i=new RegExp("[".concat(Object(o.k)(Data.snipNameDelimiterList),"]"));if(n&&(Data.matchDelimitedWord&&i&&l&&!i.test(l)&&"\n"!==l||(s=n)),s)break}return s},this.createCtxMenuEntry=function(t){let e;this.list.forEach(n=>{e=a.CTX_START[n.type]+n.name,chrome.contextMenus.create({contexts:["editable"],id:e,title:n.name,parentId:t},Object(o.g)()),listOfSnippetCtxIDs.push(e),l.isFolder(n)&&n.createCtxMenuEntry(e)}),0===this.list.length&&(e="Empty folder "+this.name,chrome.contextMenus.create({contexts:["editable"],id:e,title:"Empty folder ",parentId:t},Object(o.g)()),listOfSnippetCtxIDs.push(e))},this.forEachSnippet=b(a.SNIP_TYPE),this.forEachFolder=b(a.FOLDER_TYPE)}function c(t,e){const n=e?"normal-editor":"ql-editor",i=!e,r=o.t.new("DIV").addClass("nav"),a=o.t.new("SPAN").text("Swap editor mode: "),l=o.t.new("P").text("Textarea").addClass(o.e),c=o.t.new("P").text("Styled textbox");this.isCurrModePlain=!0,this.isQuillInitialized=!1,this.quillInitPromise=null,this.$textarea=null,this.$richEditor=null,this.quill=null,l.dataset.containerSelector="textarea",c.dataset.containerSelector=".".concat("rich_editor_container"),l.dataset.editorSelector="textarea",c.dataset.editorSelector=".".concat(n),r.appendChild(a),r.appendChild(l),r.appendChild(c),t.appendChild(r),t.addClass("dualBoxContainer"),this.$textarea=o.t.new("TEXTAREA").addClass([o.e,l.dataset.containerSelector]);const u=o.t.new("DIV").addClass("rich_editor_container");this.$richEditor=o.t.new("DIV"),t.appendChild(this.$textarea),u.appendChild(this.$richEditor),t.appendChild(u),e?(this.$richEditor.addClass(n).attr("contenteditable","true"),this.quillInitPromise=Promise.resolve(null),this.isQuillInitialized=!0):this.quillInitPromise=function(t,e){console.log("[DEBUG] Starting Quill initialization");const n="editor-".concat(Math.random().toString(36).substr(2,9)),o="toolbar-".concat(n),i=document.createElement("div");return i.id=o,i.className="ql-toolbar ql-snow",e.insertBefore(i,t),t.id=n,new Promise(e=>{try{const n=(o=0)=>{if(o>=50)return console.error("[DEBUG] Dependencies not available after maximum retries"),void e(null);if("undefined"==typeof Quill||"undefined"==typeof QuillTableBetter)return console.log("[DEBUG] Waiting for Quill and QuillTableBetter...",o),void setTimeout(()=>n(o+1),100);try{console.log("[DEBUG] Registering table-better module"),Quill.register({"modules/table-better":QuillTableBetter},!0);const n=new Quill(t,{modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block","link"],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["table-better","image"],["clean"]]},"table-better":{operationMenu:{items:{unmergeCells:{text:"Unmerge cells"}}},menus:["column","row","merge","table","cell","wrap","delete"],toolbarTable:!0,tableStyles:{width:"100%",height:"auto",table:{width:"100%","border-collapse":"collapse"},cell:{border:"1px solid #000",padding:"8px","min-width":"50px"}}}},theme:"snow",placeholder:"Start typing..."});console.log("[DEBUG] Quill instance created"),e(n)}catch(t){console.error("[DEBUG] Error during Quill initialization:",t),e(null)}};n()}catch(t){console.error("[DEBUG] Error in initializeQuill:",t),e(null)}})}(this.$richEditor,u).then(e=>e?(this.quill=e,this.$richEditor=t.querySelector(c.dataset.editorSelector),this.isQuillInitialized=!0,e):(console.error("[DEBUG] Failed to initialize Quill editor"),null));const d=async e=>{try{this.isQuillInitialized||await this.quillInitPromise;let n,r,a=t.querySelectorAll(".".concat(o.e)),l=a[1];const c=this.isCurrModePlain?this.getPlainText():this.getRichText();let u=null;try{u=JSON.parse(c)}catch(t){}a&&a.length>0&&(a.forEach(t=>t.removeClass(o.e)),l&&l.removeAttribute("tab-index")),e&&(e.addClass(o.e),n=t.querySelector(e.dataset.containerSelector),r=t.querySelector(e.dataset.editorSelector),n&&r&&(n.addClass(o.e),r.attr("tab-index",20),r.focus()));const d=this.isCurrModePlain;this.isCurrModePlain=!d,c&&c.trim()?u&&"quill-table-content"===u.type?this.isCurrModePlain?this.setPlainText(c):this.loadContent(c):i&&(this.isCurrModePlain?d?this.setPlainText(c):this.setPlainText(s.makeHTMLSuitableForTextareaThroughString(c)):this.loadContent(c)):this.isCurrModePlain?this.setPlainText(""):this.loadContent("")}catch(t){return console.error("Error in editor swap:",t),!1}};r.on("click",async t=>{const e=t.detail&&t.detail.target||t.target;if("P"!==e.tagName||e.hasClass(o.e))return!1;const n=this.isCurrModePlain?this.getPlainText():this.getRichText();return console.log("[DEBUG] Current content before trim:",n),(this.isCurrModePlain||""!==n&&"<p><br></p>"!==n&&"<p><br></p><p><br></p>"!==n)&&n&&n.trim()?(console.log("[DEBUG] Editor switch prevented - content present"),!1):d(e)}),this.userAllowsToLoseFormattingOnSwapToTextarea=function(){const t=s.getQuillClsForFormattedLossyContent(this.$richEditor.innerHTML);return!(t&&!window.confirm("We detected formatted text ".concat(t," in your expansion. You will lose it after this swap. Are you sure you wish to continue?")))},this.switchToDefaultView=async function(t){await this.quillInitPromise;const e=s.isSuitableForPastingInTextareaAsIs(t)?l:c;return await d(e),this},this.setPlainText=function(t){if(console.log("[DEBUG] Setting plain text input type:",typeof t),console.log("[DEBUG] Setting plain text input value:",t),!t)return this.$textarea.value="",this;try{let e;if(t&&"object"==typeof t&&t.body){console.log("[DEBUG] Found object with body property"),console.log("[DEBUG] Body type:",typeof t.body),console.log("[DEBUG] Body value:",t.body);try{e=JSON.parse(t.body),console.log("[DEBUG] Successfully parsed body into:",e)}catch(e){console.log("[DEBUG] Error parsing body:",e),console.log("[DEBUG] Failed to parse body:",t.body)}}else if("string"==typeof t){console.log("[DEBUG] Attempting to parse string input");try{e=JSON.parse(t),console.log("[DEBUG] Successfully parsed string into:",e)}catch(e){console.log("[DEBUG] Failed to parse string:",t)}}else console.log("[DEBUG] Using input as is:",t),e=t;if(e&&"quill-table-content"===e.type){console.log("[DEBUG] Found quill-table-content"),console.log("[DEBUG] HTML content:",e.html),console.log("[DEBUG] Delta content:",e.delta);const t=document.createElement("div");let n=e.html;console.log("[DEBUG] Step 1 - Original HTML:",n),n=n.replace(/\\&quot;|&quot;|\\"/g,'"').replace(/\\"([^"]+)\\"/g,'"$1"').replace(/\\n/g,"\n").replace(/class="[^"]*"/g,"").replace(/style="[^"]*"/g,"").replace(/data-[^=]+="[^"]*"/g,"").replace(/width="[^"]*"/g,"").replace(/height="[^"]*"/g,"").replace(/<temporary[^>]*>.*?<\/temporary>/g,"").replace(/<br\/?>/g,"").replace(/<tbody>/g,"").replace(/<\/tbody>/g,""),console.log("[DEBUG] Step 2 - After cleanup:",n),t.innerHTML=n,console.log("[DEBUG] Step 3 - After setting innerHTML:",t.innerHTML);const o=t.querySelector("table");if(o){console.log("[DEBUG] Found table element:",o.outerHTML);const t=Array.from(o.querySelectorAll("tr"));if(console.log("[DEBUG] Found rows:",t.length),console.log("[DEBUG] Row elements:",t.map(t=>t.outerHTML)),0===t.length)return console.log("[DEBUG] No rows found in table"),this;const e=t.map((t,e)=>{console.log("[DEBUG] Processing row ".concat(e," HTML:"),t.innerHTML);const n=Array.from(t.querySelectorAll("td"));return console.log("[DEBUG] Found ".concat(n.length," cells in row ").concat(e)),n.map((t,n)=>{const o=t.querySelector("p");console.log("[DEBUG] Cell [".concat(e,",").concat(n,"] HTML:"),t.innerHTML),console.log("[DEBUG] Cell [".concat(e,",").concat(n,"] p element:"),o?o.outerHTML:"none");const i=(o?o.textContent:t.textContent).trim();return console.log("[DEBUG] Cell [".concat(e,",").concat(n,"] extracted content:"),i),i||" "})});console.log("[DEBUG] Final extracted table data:",e);const n=[];for(let t=0;t<e[0].length;t++)n[t]=Math.max(3,...e.map(e=>(e[t]||"").length)),console.log("[DEBUG] Column ".concat(t," width:"),n[t]);const i=Math.max(...n);n.fill(i),console.log("[DEBUG] Using consistent width for all columns:",i);let r="\n";const a="+"+n.map(t=>"-".repeat(t+2)).join("+")+"+\n";return console.log("[DEBUG] Separator line:",a),r+=a,e.forEach((t,e)=>{const o="|"+t.map((t,e)=>" "+t.padEnd(n[e])+" ").join("|")+"|\n";console.log("[DEBUG] Row ".concat(e," ASCII:"),o),r+=o+a}),console.log("[DEBUG] Final ASCII table:",r),this.$textarea.value=r,this}console.log("[DEBUG] No table element found in cleaned HTML")}else console.log("[DEBUG] Content is not quill-table-content:",e);if(e&&e.html){console.log("[DEBUG] Handling as regular HTML content");const t=document.createElement("div");return t.innerHTML=e.html,this.$textarea.value=t.textContent.trim(),this}if(e&&e.delta&&e.delta.ops){console.log("[DEBUG] Handling as delta content"),console.log("[DEBUG] Delta ops:",e.delta.ops);const t=e.delta.ops.map(t=>t.insert||"").join("").trim();return console.log("[DEBUG] Extracted text from delta:",t),this.$textarea.value=t,this}}catch(t){console.log("[DEBUG] Error in setPlainText:",t),console.log("[DEBUG] Error stack:",t.stack)}return console.log("[DEBUG] Falling back to plain text handling"),this.$textarea.value="string"==typeof t?t:String(t),this},this.getShownTextForSaving=async function(){if(console.log("[DEBUG] getShownTextForSaving called"),await this.quillInitPromise,this.isCurrModePlain)return s.sanitizeTextareaTextForSave(this.$textarea.value);if(!this.quill)return console.error("[DEBUG] Quill not initialized"),"";const t=this.quill.root.innerHTML,e=this.quill.getContents();return JSON.stringify({type:"quill-table-content",html:t,delta:e})}}function u(t){const e=["push","pop","shift","unshift","splice"];for(const n of e)Object.defineProperty(t,n,{configurable:!1,enumerable:!1,writable:!1,value:function(e){return function(...n){const o=[][e].apply(t,n);return l.setIndices(),o}}(n)})}a.HIGHLIGHTING_CLASS="highlighting",a.FOLDER_TYPE="folder",a.SNIP_TYPE="snip",a.CTX_START={},a.CTX_START[a.SNIP_TYPE]="".concat(a.SNIP_TYPE,"_"),a.CTX_START[a.FOLDER_TYPE]="".concat(a.FOLDER_TYPE,"_"),a.CTX_SNIP_REGEX=new RegExp(a.CTX_START[a.SNIP_TYPE]),a.prototype.getDOMElement=function(t){t=void 0===t?[]:Array.isArray(t)?t:[t];const e=o.t.new("div").addClass([this.type,"generic",s.DOMContractedClass]),n=o.t.new("img");n.src="../imgs/".concat(this.type,".svg"),e.appendChild(n);const i=o.t.new("div").html(Object(o.l)(this.name)).addClass("name");return i.dataset.name=this.name,e.appendChild(i),e.appendChild(this.getButtonsDOMElm()),t.indexOf(this.name)>-1&&(!1!==t[0]&&e.removeClass(s.DOMContractedClass),e.addClass(a.HIGHLIGHTING_CLASS),setTimeout(()=>{e.removeClass(a.HIGHLIGHTING_CLASS)},3e3)),e},a.prototype.getButtonsDOMElm=function(){const t=document.createElement("div");t.className="buttons";const e=document.createElement("div");e.classList.add("edit_btn"),e.classList.add("panel_btn"),e.title="Edit";const n=document.createElement("div");n.classList.add("delete_btn"),n.classList.add("panel_btn"),n.title="Delete";const o=document.createElement("div");return o.classList.add("clone_btn"),o.classList.add("panel_btn"),o.title="Clone",t.appendChild(e),t.appendChild(n),t.appendChild(o),t},a.prototype.preventButtonClickOverride=function(t){return function(e){e.target.matches(".buttons, .buttons div")||t.call(this,e)}},a.prototype.getDuplicateObjectsText=function(t,e){return"A ".concat(e," with name '").concat(t,"' already exists (possibly with the same letters in upper/lower case.)")},a.prototype.isValidName=function(t,e){if(0===t.length)return"Empty name field";if(t.length>o.b)return"Name cannot be greater than ".concat(o.b," characters. Current name has ").concat(t.length-o.b," more characters.");try{return Data.snippets.getUniqueObject(t,e)?a.getDuplicateObjectsText(t,e):"true"}catch(t){return"true"}},a.prototype.getObjectThroughDOMListElm=function(t){const e=t.classList.contains("snip")?a.SNIP_TYPE:a.FOLDER_TYPE,{name:n}=t.qClsSingle("name").dataset;return Data.snippets.getUniqueObject(n,e)},s.prototype=new a,s.MAX_COLLAPSED_CHARACTERS_DISPLAYED=200,s.DOMContractedClass="contracted",s.PASTE_MACRO_REGEX=/\[\[%p\]\]/gi,s.CARET_POSITION_CLASS="caretPlacement",s.CARET_POSITION_EMPTY_REGEX=/\[\[%c(\(\))?\]\]/,s.CARET_POSITION_STUFFED_REGEX=/\[\[%c\([v^<>\d]+\)\]\]/,s.CARET_POSITION_SELECTION_START_REGEX=/\[\[%c\(s\)\]\]/,s.CARET_POSITION_SELECTION_END_REGEX=/\[\[%c\(e\)\]\]/,s.CARET_POSITION_SELECTION_END_STRING="[[%c(e)]]",s.fromObject=function(t){const e=new s(t.name,t.body);return e.timestamp=t.timestamp?"number"==typeof t.timestamp?t.timestamp:Date.parse(t.timestamp.substring(11)):Date.now(),e},s.isValidName=function(t){const e=a.isValidName(t,a.SNIP_TYPE);return/^%.+%$/.test(t)?"Name cannot be of the form '%abc%'":e},s.isValidBody=function(t){return t.length?"true":"Empty body field"},s.getTimestampString=function(t){return"Created on ".concat(Object(r.d)(t.timestamp))},s.makeHTMLSuitableForTextareaThroughString=function(t){const e=document.createElement("div");return e.innerHTML=t,s.makeHTMLSuitableForTextarea(e)},s.makeHTMLSuitableForTextarea=function(t){console.log("[DEBUG] makeHTMLSuitableForTextarea input:",t.innerHTML);try{if(t.innerHTML.includes("quill-table-content")){console.log("[DEBUG] Found table content");const e=document.createElement("div");e.innerHTML=t.innerHTML;const n=e.querySelector("table");if(n){console.log("[DEBUG] Found table element:",n.outerHTML);const t=Array.from(n.querySelectorAll("tr"));if(console.log("[DEBUG] Found rows:",t.length),0===t.length)return console.log("[DEBUG] No rows found"),"";const e=t.map((t,e)=>(console.log("[DEBUG] Processing row ".concat(e,":"),t.innerHTML),Array.from(t.querySelectorAll("td")).map((t,n)=>{const o=t.querySelector("p"),i=(o?o.textContent:t.textContent).trim();return console.log("[DEBUG] Cell [".concat(e,",").concat(n,"] content:"),i),i||" "})));console.log("[DEBUG] Table data:",e);const o=[];for(let t=0;t<e[0].length;t++)o[t]=Math.max(3,...e.map(e=>(e[t]||"").length));let i="\n";const r="+"+o.map(t=>"-".repeat(t+2)).join("+")+"+\n";return i+=r,e.forEach(t=>{i+="|"+t.map((t,e)=>" "+t.padEnd(o[e])+" ").join("|")+"|\n"+r}),console.log("[DEBUG] ASCII table:",i),i}const o=t.innerHTML.match(/"delta":\s*({[^}]+})/);if(o){console.log("[DEBUG] Found delta content");try{const t=JSON.parse(o[1]);if(t.ops){const e=t.ops.map(t=>t.insert&&"object"==typeof t.insert&&t.insert.image?"[Pictures cannot be displayed in plain-text boxes.]":t.insert||"").join("").trim();return console.log("[DEBUG] Extracted text from delta:",e),e}}catch(t){console.log("[DEBUG] Error parsing delta:",t)}}}function e(t){const e=t.tagName.toLowerCase(),n=["<".concat(e,">"),"</".concat(e,">")];return"a"===e&&(n[0]="<a href='".concat(t.href,"'>")),"span"!==e?n:["",""]}function n(t){if(Object(o.r)(t))return t.textContent;let i,r,a,s,l,{tagName:c}=t,u="",d=t.childNodes,p=0,h=d.length;if("IMG"===c)return"[Pictures cannot be displayed in plain-text boxes.]";if("PRE"===c)return(r=e(t))[0]+t.innerHTML+r[1];if("P"===c&&1===h){if(l=(s=d[0]).innerText||s.textContent,"BR"===s.tagName)return"";if(0===l.length)return""}for(;p<h;p++)1===(i=d[p]).nodeType?(a=(r=e(i))[0]+n(i)+r[1],"LI"===i.tagName?u+="    ".concat(a,"\n"):u+=a):u+=i.textContent;switch(c){case"BLOCKQUOTE":return"<blockquote>".concat(u,"</blockquote>");case"OL":return"<ol>\n".concat(u,"</ol>");case"UL":return"<ul>\n".concat(u,"</ul>");case"TABLE":return"<table>".concat(u,"</table>");case"TR":return"<tr>".concat(u,"</tr>");default:return u}}console.log("[DEBUG] Handling as regular HTML");let i,r,a=t.childNodes,s="",l=a.length,c=0;for(;c<l;)s+="<!!>"===(r=n(i=a[c]))?"":"".concat(r,"\n"),c++;return s=(s=s.replace(/&nbsp;/g," ")).substring(0,s.length-1),console.log("[DEBUG] Final output:",s),s}catch(t){return console.log("[DEBUG] Error in makeHTMLSuitableForTextarea:",t),console.log("[DEBUG] Error stack:",t.stack),""}},s.isSuitableForPastingInTextareaAsIs=function(t){return!(s.hasFormattedLossyContentWoQuillCls(t)||/<p>|<br>/.test(t))},s.hasFormattedLossyContentWoQuillCls=function(t){const e=[/background-color: /,/color: /,/text-align: /,/font-size: /,/font-family: /];for(let n=0,o=e.length;n<o;n++)if(e[n].test(t))return!0;return!1},s.getQuillClsForFormattedLossyContent=function(t){const e=[[/ql-font/,"font"],[/ql-align/,"alignment"],[/ql-size/,"size"],[/color: /,"color"],[/background-color: /,"background color"]];for(let n=0,o=e.length;n<o;n++)if(e[n][0].test(t))return e[n][1];return null},s.stripAllTags=function(t,e){e||(e=o.t.new("DIV")),t&&(e.innerHTML=t);const{tagName:n}=e;switch(n){case"DIV":case"OL":case"UL":break;default:return e.innerText.replace(/\n/g," ")}const i=e.childNodes,r=i.length;let a="",l=0;if(0===r)return e.innerText.replace(/\n/g," ");for(;l<r;l++)a+="".concat(s.stripAllTags("",i[l]),"\n");return a},s.defaultLinkSanitize=function(t){return t=t.replace(/^chrome-extension:\/\/[a-z]+\/html\//,""),/^\w+:/.test(t)||/^https?:/.test(t)||(t="http:".concat(t)),t},s.formatOLULInListParentForTextarea=Object(i.a)("    ","\n"),s.sanitizeTextareaTextForSave=function(t){const e=o.t.new("div");return e.innerHTML=t,e.innerHTML=e.innerHTML.replace(/&nbsp;/g," "),e.querySelectorAll("a").forEach(t=>{t.href=s.defaultLinkSanitize(t.href)}),e.querySelectorAll("ol, ul").forEach(s.formatOLULInListParentForTextarea),e.innerHTML},s.validate=function(t,e,n){let i,r,c=["name","body","timestamp"],u=c.length,d={body:s.isValidBody,name:s.isValidName},p="".concat(n,"th snippet under folder ").concat(e);if(Array.isArray(t)){if("true"!==(r=l.validate(t)))return r}else{if(!Object(o.p)(t))return"".concat(p," is not an object.");{let e=0;for(const n of Object.keys(t)){if(-1===c.indexOf(n)){delete t[n];continue}e++,i=t[n];const o=d[n];if(o&&("true"!==(r=o(i))&&a.getDuplicateObjectsText(i,a.SNIP_TYPE)!==r))return"Invalid value for property ".concat(n," in ").concat(p,"; received error: ").concat(r)}if(e!==u)return"".concat(p," is missing one of the properties: ").concat(JSON.stringify(c))}}return"true"},l.prototype=new a,l.fromArray=function(t){"string"!=typeof t[0]&&t.unshift(l.MAIN_SNIPPETS_NAME),"number"!=typeof t[1]&&t.splice(1,0,Date.now());const e=new l(t.shift(),void 0,t.shift());return e.list=t.map(t=>Array.isArray(t)?l.fromArray(t):s.fromObject(t)),window.IN_OPTIONS_PAGE&&u(e.list),e},l.isValidName=function(t){return a.isValidName(t,a.FOLDER_TYPE)},l.isFolder=function(t){return t&&t.type===a.FOLDER_TYPE},l.makeFolderIfList=function(t){t&&Array.isArray(t.snippets)&&(t.snippets=l.fromArray(t.snippets))},l.makeListIfFolder=function(t){l.isFolder(t.snippets)&&(t.snippets=t.snippets.toArray())},l.MAIN_SNIPPETS_NAME="Snippets",l.SEARCH_RESULTS_NAME="Search Results in ",l.CHEVRON_TEXT="<<",l.setIndices=function(){function t(t,e,n){l.indices[t][e.toLowerCase()]=n}l.indices={},l.indices[a.FOLDER_TYPE]={},l.indices[a.SNIP_TYPE]={},!1!==Data.snippets&&function e(n,o){let i,r=0;t(n.type,n.name,o),n.list.forEach(n=>{i=o.concat(r),l.isFolder(n)?e(n,i):t(n.type,n.name,i),r++})}(Data.snippets,[])},l.copyContents=function(t,e){const{list:n}=t;for(let t=n.length-1;t>=0;t--)l.insertObject(n[t].getDuplicatedObject(),e)},l.insertObject=function(t,e){l.isFolder(t)?e.list.unshift(t):e.list.splice(e.getLastFolderIndex()+1,0,t)},l.insertBulkActionDOM=function(t){const e=o.t.new("div");return t.list.forEach(t=>{const n=o.t.new("div").addClass("generic"),i=o.t.new("input"),r=o.t.new("img"),a=o.t.new("div").addClass("name").html(Object(o.l)(t.name));a.dataset.name=t.name,i.type="checkbox",r.src="../imgs/".concat(t.type,".svg"),n.appendChild(i),n.appendChild(r),n.appendChild(a),e.appendChild(n)}),$containerSnippets.html("").appendChild(e),e},l.getSelectedFolderInSelectList=function(t){const e=t.qClsSingle("selected").dataset.name;return Data.snippets.getUniqueFolder(e)},l.refreshSelectList=function(t){t.html("").appendChild(Data.snippets.getFolderSelectList()),t.children[0].children[0].addClass("selected")},l.implementChevronInFolderPath=function(t){const e=15;const n=$containerFolderPath.offsetWidth,o=function(){let t=0,n=[].slice.call($containerFolderPath.children,0).reduce((e,n)=>n.hasClass("right_arrow")?(t++,e):e+n.offsetWidth,0);return n+=t*e}(),i=$containerFolderPath.lastChild.previousElementSibling,r=l.getListedFolder();if(o>n){const t=$containerFolderPath.querySelector(".path_part:not(.chevron)");if(t===i)t.style.width="".concat($containerFolderPath.offsetWidth-e-50,"px"),t.addClass("ellipsized");else{const e=!!$containerFolderPath.querySelector(".chevron");$containerFolderPath.removeChild(t.nextElementSibling),e?$containerFolderPath.removeChild(t):t.addClass("chevron").html(l.CHEVRON_TEXT),l.implementChevronInFolderPath(!0)}}else!t&&$containerFolderPath.querySelector(".chevron")&&r.insertFolderPathDOM()},l.getListedFolderName=function(){return $containerFolderPath.querySelector(":nth-last-child(2)").dataset.name},l.getListedFolder=function(){let t=l.getListedFolderName();return-1!==t.indexOf(l.SEARCH_RESULTS_NAME)&&(t=t.substring(l.SEARCH_RESULTS_NAME.length)),Data.snippets.getUniqueFolder(t)},l.validate=function(t){"string"!=typeof t[0]&&(t.unshift(Date.now()),t.unshift(l.MAIN_SNIPPETS_NAME));const e=t[0],n=t[1],o=t.slice(2),i="Folder ".concat(e);let r;if("string"!=typeof e)return"Name of ".concat(i," is not a string.");const c=l.isValidName(e);if("true"!==c&&a.getDuplicateObjectsText(e,a.FOLDER_TYPE)!==c)return"Name of ".concat(i," is invalid because: ").concat(c);if("number"!=typeof n)return"Timestamp for ".concat(i," is not a number");for(let t,n=0,i=o.length;n<i;n++)if(t=o[n],"true"!==(r=s.validate(t,e,n)))return r;return"true"},l.getDefaultSnippetData=function(){const t=Date.now(),e=new l(l.MAIN_SNIPPETS_NAME,[],t);return e.list=[new l("sampleFolder",[],t),new s("sampleSnippet","Hello new user! Thank you for using DotExpander!\n\nThis is a sample snippet. Try using it on any webpage by typing 'sampleSnippet' (snippet name; without quotes), and press the hotkey (default: Shift+Space), and this whole text would come in place of it.",t),new s("letter","(Sample snippet to demonstrate the power of DotExpander snippets; for more detail on Placeholders, see the Help section)\n\nHello %name%,\n\nYour complaint number %complaint% has been noted. We will work at our best pace to get this issue solved for you. If you experience any more problems, please feel free to contact at me@organization.com.\n\nRegards,\n%my_name%,\nDate: [[%d(D-MM-YYYY)]]",t),new s("brb","be right back",t),new s("my_sign","<b>DotExpander &#169;</b>\n<i>Created by DoctorDurant LLC</i>\n<u>james@doctordurant.com</u>",t),new s("dateArithmetic","Use this snippet in any webpage, and you'll see that the following: [[%d(Do MMMM YYYY hh:m:s)]] is replaced by the current date and time.\n\nMoreover, you can perform date/time arithmetic. The following: [[%d(D+5 MMMM+5 YYYY+5 hh-5:m-5:s-5)]] gives the date, month, year, forward by five; and hour, minutes, and seconds backward by 5.\n\nMore info on this in the Help section.",t),new s("urlMacro","Use the URL macro (details in the Help page) to retrieve parts of the URL of the active webpage. For example, [[%u(host)]] gives the hostname.",t),new s("README-New_UI_Details","Dear user, here are some things you need to know in this new UI:\n\n1. You need to click on the name or body of the listed snippet to expand it completely. In the following image, the purple area shows where you can click to expand the snippet.\n\n<img src='../imgs/help1.png'>\n\n2. Click on the pencil icon to edit and the dustbin icon to delete a snippet/folder.\n3. Click on the folder, anywhere in the purple area denoted below, to view its contents.\n\n<img src='../imgs/help2.png'>\n\n4. Click on a folder name in the navbar to view its contents. In the example below, the navbar consists of 'Snippets', 'sampleFolder' and 'folder2',  each nested within the previous.\n\n<img src='../imgs/help3.png'>",t),new s("clipboard_macro","Use this snippet anywhere and the following - [[%p]] - will be replaced by  your clipboard data. Clipboard data includes text that you have previously copied or cut with intention to paste.",t)],e},c.prototype.getPlainText=function(){return this.$textarea.value},c.prototype.getRichText=function(){return this.quill&&this.quill.getLength()<=1?"":this.$richEditor.innerHTML},c.prototype.setRichText=async function(t){if(console.log("[DEBUG] Setting rich text:",t),!this.isQuillInitialized&&this.quillInitPromise&&(console.log("[DEBUG] Waiting for Quill initialization"),await this.quillInitPromise),this.quill){try{if(this.isCurrModePlain&&t&&"object"==typeof t&&"quill-table-content"===t.type){console.log("[DEBUG] Auto-switching to rich text mode for table content");const t=document.querySelector(".nav p:not(.show)");t&&(t.click(),await new Promise(t=>setTimeout(t,100)))}this.loadContent(t)}catch(t){console.error("[DEBUG] Error in setRichText:",t),this.quill.setText("")}return this}console.error("[DEBUG] Quill not available")},c.prototype.loadContent=function(t){console.log("[DEBUG] Loading content:",t);try{if(!this.quill)return void console.error("[DEBUG] Quill not initialized");let e,n=t;if("string"==typeof t&&t.trim())try{n=JSON.parse(t)}catch(t){console.log("[DEBUG] Content is not JSON structured")}const o=t=>t&&(t.includes("<table")||t.includes("</table>")||t.includes("<td")||t.includes("</td>")||t.includes("<th")||t.includes("</th>"));if(n&&"object"==typeof n){if("quill-table-content"===n.type&&n.html)if(o(n.html))if(console.log("[DEBUG] Loading structured table content with HTML:",n.html),n.delta&&n.delta.ops){console.log("[DEBUG] Using stored delta"),e=new(this.quill.constructor.import("delta"))(n.delta.ops)}else console.log("[DEBUG] Converting HTML to delta"),e=this.quill.clipboard.convert(n.html);else console.log("[DEBUG] Content marked as table but no table found - treating as regular content"),e=this.quill.clipboard.convert(n.html);else if(n.ops){console.log("[DEBUG] Using provided delta"),e=new(this.quill.constructor.import("delta"))(n.ops)}}else"string"==typeof n&&(console.log("[DEBUG] Converting HTML/text content"),e=this.quill.clipboard.convert(n));if(!e||!e.ops||!e.ops.length){console.log("[DEBUG] No valid delta content, creating empty delta"),e=(new(this.quill.constructor.import("delta"))).insert("\n")}console.log("[DEBUG] Final delta to apply:",e),this.quill.setText(""),this.quill.updateContents(e,Quill.sources.USER),this.quill.focus(),this.quill.setSelection(0,0),console.log("[DEBUG] Content loaded successfully")}catch(t){console.error("[DEBUG] Error loading content:",t),this.quill.setText("")}},s.getPreviewText=function(t){try{const e="string"==typeof t?JSON.parse(t):t;if(e&&"quill-table-content"===e.type)return e.html.replace(/<table[^>]*>/g,"\n[Table Start]\n").replace(/<\/table>/g,"\n[Table End]\n").replace(/<tr[^>]*>/g,"").replace(/<\/tr>/g,"\n").replace(/<td[^>]*>/g,"| ").replace(/<\/td>/g," ").replace(/<p[^>]*>/g,"").replace(/<\/p>/g,"").replace(/<br\/?>/g,"\n").replace(/<[^>]+>/g,"").replace(/\n{3,}/g,"\n\n").trim()}catch(t){}return t},s.makeHTMLValidForExternalEmbed=function(t,e){if(console.log("[DEBUG] makeHTMLValidForExternalEmbed input:",t),console.log("[DEBUG] Raw input length:",t.length),console.log("[DEBUG] Input newline count:",(t.match(/\n/g)||[]).length),!t)return console.log("[DEBUG] makeHTMLValidForExternalEmbed: empty input"),"";let n=t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n{3,}/g,"\n\n").trim();console.log("[DEBUG] After newline normalization:",n),console.log("[DEBUG] Normalized newline count:",(n.match(/\n/g)||[]).length);const i=o.t.new("div");if(n=n.replace(new RegExp("<span[^>]*".concat(s.CARET_POSITION_CLASS,"[^>]*>"),"g"),""),console.log("[DEBUG] After caret removal:",n),!n.includes("<p>")){console.log("[DEBUG] Converting newlines to paragraphs");let t=n.split(/\n\s*\n/).filter(t=>t.trim());console.log("[DEBUG] Paragraph count after split:",t.length),n=(n="<p>"+t.join("</p><p>")+"</p>").replace(/\n/g,"<br>"),console.log("[DEBUG] After paragraph conversion:",n)}i.innerHTML=n,console.log("[DEBUG] Container HTML after initial set:",i.innerHTML),console.log("[DEBUG] Paragraph elements count:",i.querySelectorAll("p").length),console.log("[DEBUG] BR elements count:",i.querySelectorAll("br").length),i.querySelectorAll("table").forEach((t,e)=>{console.log("[DEBUG] Processing table ".concat(e+1)),t.setAttribute("style","border-collapse: collapse !important; width: 100% !important; border: 1px solid black !important; margin-bottom: 10px !important;"),t.className=t.className.replace(/dotexpander-table/g,"")+" dotexpander-table";const n=t.querySelectorAll("td, th");console.log("[DEBUG] Table ".concat(e+1," cell count:"),n.length)});const r=i.querySelectorAll("p");let a=0;r.forEach(t=>{t.innerHTML;t.innerHTML=t.innerHTML.replace(/\s+/g," ").trim(),t.innerHTML&&"<br>"!==t.innerHTML&&"&nbsp;"!==t.innerHTML||(t.remove(),a++)}),console.log("[DEBUG] Removed empty paragraphs count:",a);let l=i.innerHTML.replace(/>\s+</g,"><").replace(/\s+/g," ").trim();return console.log("[DEBUG] Final HTML length:",l.length),console.log("[DEBUG] Final paragraph count:",(l.match(/<p>/g)||[]).length),console.log("[DEBUG] Final BR count:",(l.match(/<br>/g)||[]).length),console.log("[DEBUG] Final processed HTML:",l),l}},,function(t,e,n){"use strict";n.d(e,"b",function(){return f}),n.d(e,"j",function(){return b}),n.d(e,"h",function(){return E}),n.d(e,"g",function(){return y}),n.d(e,"i",function(){return p}),n.d(e,"f",function(){return l}),n.d(e,"c",function(){return u}),n.d(e,"d",function(){return d}),n.d(e,"e",function(){return c}),n.d(e,"a",function(){return m});n(0);var o=n(1),i=n(5);const r=t=>{if(t===o.c.FOLDER_TYPE||t===o.c.SNIP_TYPE)return t;return{r:o.c.FOLDER_TYPE,o:o.c.SNIP_TYPE,a:o.c.FOLDER_TYPE,i:o.c.SNIP_TYPE,folder:o.c.FOLDER_TYPE,snip:o.c.SNIP_TYPE}[t]||t};function a(t){var e;if(console.log("[SERIALIZE_SNIPPET_DATA] Input:",{type:null==t?void 0:t.type,name:null==t?void 0:t.name,listLength:null==t||null===(e=t.list)||void 0===e?void 0:e.length,isInstance:t instanceof o.b}),!t)return null;const n=r(t.type),i={type:n,name:t.name,timestamp:t.timestamp};var s;n===o.c.FOLDER_TYPE?i.list=null===(s=t.list)||void 0===s?void 0:s.map(t=>a(t)).filter(Boolean):n===o.c.SNIP_TYPE&&(i.body=t.body);return i}function s(t){var e;if(console.log("[DESERIALIZE_SNIPPET_DATA] Input:",{type:null==t?void 0:t.type,name:null==t?void 0:t.name,listLength:null==t||null===(e=t.list)||void 0===e?void 0:e.length,isPlainObject:(null==t?void 0:t.constructor)===Object}),!t)return null;const n=r(t.type);if(n===o.c.FOLDER_TYPE){const e=new o.b(t.name,[],t.timestamp);return t.list&&Array.isArray(t.list)&&(e.list=t.list.map(t=>s(t)).filter(Boolean)),e}return n===o.c.SNIP_TYPE?new o.d(t.name,t.body||"",t.timestamp):null}const l={snippets:o.b.getDefaultSnippetData(),blockedSites:[],charsToAutoInsertUserList:[["(",")"],["{","}"],['"','"'],["[","]"]],dataVersion:1,language:"English",hotKey:["shiftKey","Tab"],dataUpdateVariable:!0,matchDelimitedWord:!0,tabKey:!1,snipNameDelimiterList:" @#$%&*+-=(){}[]:\"'/_<>?!.,",omniboxSearchURL:"https://www.google.com/search?q=SEARCH",wrapSelectionAutoInsert:!0,ctxEnabled:!0,dotPhrasesEnabled:!0,darkMode:!1},c="UserSnippets",u="prokeys_revisions",d="pkStorageType";function p(t){let e=JSON.parse(localStorage[u]);const n={label:"".concat(Object(i.d)()," - ").concat(window.latestRevisionLabel),data:t||Data.snippets};e.unshift(n),e=e.slice(0,20);let o=!0;for(;o;)try{localStorage[u]=JSON.stringify(e),o=!1}catch(t){o=!0,e.pop()}}const h=window.location.href&&/chrome-extension:\/\//.test(window.location.href);function f(t){console.log("[CDH] Requesting data from service worker");try{chrome.runtime.sendMessage({giveData:!0},async e=>{if(console.log("[CDH] Received raw data:",e),e.error)throw console.error("[CDH] Error getting data:",e.error),new Error(e.error);e.snippets&&(console.log("[CDH] Deserializing snippets"),e.snippets=s(e.snippets),console.log("[CDH] Deserialized snippets:",e.snippets),console.log("[CDH] snippets instanceof Folder:",e.snippets instanceof o.b)),t&&t(e)})}catch(t){throw console.error("[CDH] Error in DBget:",t),t}}function g(t){console.log("[CDH] Updating data:",Data),console.log("[CDH] Data.snippets instanceof Folder:",Data.snippets instanceof o.b);try{Data.snippets&&(console.log("[CDH] Ensuring proper instances before update"),Data.snippets=ensureProperInstances(Data.snippets),console.log("[CDH] Prepared snippets:",Data.snippets),console.log("[CDH] snippets instanceof Folder:",Data.snippets instanceof o.b));const e={...Data,snippets:a(Data.snippets)};chrome.runtime.sendMessage({updateData:e},e=>{if(console.log("[CDH] Update response:",e),e.error)throw console.error("[CDH] Error updating data:",e.error),new Error(e.error);t&&t(e)})}catch(t){throw console.error("[CDH] Error in DBupdate:",t),t}}async function m(t){var e,n;console.log("[DB_SAVE] Starting save with data:",{hasData:!!Data,hasSnippets:!(null===(e=Data)||void 0===e||!e.snippets),isSnippetsFolder:(null===(n=Data)||void 0===n?void 0:n.snippets)instanceof o.b});try{if(!Data||!Data.snippets)throw new Error("Invalid data structure");o.b.makeListIfFolder(Data),Data.dataUpdateVariable=!Data.dataUpdateVariable;const e=await chrome.runtime.sendMessage({type:"updateStorage",data:{key:c,value:Data}});if(console.log("[DB_SAVE] Storage update response:",e),null!=e&&e.success){if(o.b.makeFolderIfList(Data),t)try{t()}catch(t){console.error("[DB_SAVE] Callback error:",t)}}else console.error("[DB_SAVE] Failed to update storage:",null==e?void 0:e.error)}catch(t){console.error("[DB_SAVE] Error during save:",t),o.b.makeFolderIfList(Data)}}function b(t,e,n){console.log("[SAVE_SNIPPET_DATA] Starting save:",{hasCallback:!!t,folderNameToList:e,objectNamesToHighlight:n});try{!Data.snippets||Data.snippets instanceof o.b||(console.log("[SAVE_SNIPPET_DATA] Converting data to proper instances"),Data.snippets=ensureProperInstances(Data.snippets)),m(()=>{try{h?(console.log("[SAVE_SNIPPET_DATA] Updating UI in options page"),chrome.runtime.sendMessage({getData:!0},e=>{console.log("[SAVE_SNIPPET_DATA] Got fresh data:",{hasData:!!e,hasSnippets:!(null==e||!e.snippets)}),null!=e&&e.snippets?(Data=e,Data.snippets=s(e.snippets),window.$containerSnippets?(window.$containerSnippets.html(""),Data.snippets&&"function"==typeof Data.snippets.listSnippets?Data.snippets.listSnippets(n):console.error("[SAVE_SNIPPET_DATA] Data.snippets is not properly initialized")):console.warn("[SAVE_SNIPPET_DATA] Container not found"),Data.snippets instanceof o.b&&o.b.setIndices(Data.snippets)):console.error("[SAVE_SNIPPET_DATA] No snippets in response:",e),t&&t()})):t&&t()}catch(t){if(console.error("[SAVE_SNIPPET_DATA] Error in save callback:",t),h&&window.$containerSnippets&&Data.snippets)try{Data.snippets.listSnippets()}catch(t){console.error("[SAVE_SNIPPET_DATA] Failed to recover UI:",t)}}})}catch(t){console.error("[SAVE_SNIPPET_DATA] Error during save:",t)}}function E(t="Saved!",e){g(()=>{"function"==typeof t?t():"string"==typeof t&&window.alert(t),e&&e()})}function y(t,e){const n=Data.snippets.toArray();Data.snippets=!1,g(()=>{chrome.runtime.sendMessage({changeStorageType:!0,overridingSync:t},o=>{if(!1===o.completed)return Data.snippets=n,void g(()=>{e(!1)});t?(Data.snippets=n,g(()=>e(!0))):e&&e(!0)})})}},function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return a});var o=n(0);const i={};function r(t,e,n){n.Array.prototype[t]=n.NodeList.prototype[t]=n.HTMLCollection.prototype[t]=function(...t){for(let n=0,o=this.length;n<o;n++)e.apply(this[n],t);return this},n.Node.prototype[t]=e}function a(t){for(const[e,n]of Object.entries(i))r(e,n,t);t[o.c]=!0}function s(t,e){i[t]=e}},function(t,e,n){"use strict";n.d(e,"c",function(){return a}),n.d(e,"e",function(){return l}),n.d(e,"f",function(){return s}),n.d(e,"d",function(){return p}),n.d(e,"b",function(){return r}),n.d(e,"a",function(){return h});const o=["January","February","March","April","May","June","July","August","September","October","November","December"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],r=864e5;function a(){const t=new Date,e=Number.padNumber(t.getHours()),n=Number.padNumber(t.getMinutes()),o=Number.padNumber(t.getSeconds());return"".concat(e,":").concat(n,":").concat(o)}function s(t){return t%4==0&&t%100!=0||t%400==0}function l(t){const e=new Date,n=Math.abs(t),o=t<0,i=o?1:-1;let r=0,a=e.getMonth(),l=e.getFullYear(),c=0;for(;c<=n;){switch((a+=i)>11?(a=0,l++):a<0&&(a=11,l--),a){case 0:case 2:case 4:case 6:case 7:case 9:case 11:r++;break;case 1:r--,s(l)||r--}c++}return o?-r:r}function c(t){return 0===t?[12,"am"]:12===t?[12,"pm"]:t>=1&&t<12?[t,"am"]:[t-12,"pm"]}function u(t,e){return"full"===e?i[t]:i[t].slice(0,3)}function d(t,e){return"full"===e?o[t]:o[t].slice(0,3)}function p(t){return(t?new Date(t):new Date).toString().substring(4,15)}const h=[["s([+-]\\d+)?",[function(t){return Number.padNumber(t.getSeconds())},1e3]],["\\bm([+-]\\d+)?\\b",[function(t){return Number.padNumber(t.getMinutes())},6e4]],["hh([+-]\\d+)?",[function(t){return Number.padNumber(t.getHours())},36e5]],["h([+-]\\d+)?",[function(t){return Number.padNumber(c(t.getHours())[0])},36e5]],["\\ba\\b",[function(t){return c(t.getHours())[1]},r]],["Do([+-]\\d+)?",[function(t){return function(t){const e=t%10;let n="th";return 1===e&&11!==t?n="st":2===e&&12!==t?n="nd":3===e&&13!==t&&(n="rd"),t+n}(t.getDate())},r]],["D([+-]\\d+)?",[function(t){return Number.padNumber(t.getDate())},r]],["dddd([+-]\\d+)?",[function(t){return u(t.getDay(),"full")},r]],["ddd([+-]\\d+)?",[function(t){return u(t.getDay(),"half")},r]],["MMMM([+-]\\d+)?",[function(t){return d(t.getMonth(),"full")},30*r]],["MMM([+-]\\d+)?",[function(t){return d(t.getMonth(),"half")},30*r]],["MM([+-]\\d+)?",[function(t){return Number.padNumber(t.getMonth()+1)},30*r]],["YYYY([+-]\\d+)?",[function(t){return t.getFullYear()},365*r]],["YY([+-]\\d+)?",[function(t){return t.getFullYear()%100},365*r]],["ZZ",[function(t){return t.toString().match(/\((.*)\)/)[1]},0]],["Z",[function(t){return t.toString().match(/\((.*)\)/)[1].split(" ").reduce((t,e)=>t+e[0],"")},0]],["z",[function(t){return t.toString().match(/GMT(.*?) /)[1]},0]],["J",[function(t){return t.getDayOfYear()},0]],["date",[p,0]],["time",[a,0]]]},function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i}),n.d(e,"e",function(){return r}),n.d(e,"c",function(){return a}),n.d(e,"d",function(){return s});const o={ENABLED:!1,OBJECT_NAME_LIMIT:50},i={SHOW_CLASS:"show",PRIMITIVES_EXT_KEY:"primitivesExtended"},r={BLOCKED_PATTERNS:[/^chrome-extension:/,/^chrome:/,/^https?:\/\/chrome\.google\.com/,/^about:blank/,/^www\./i]},a={MODIFIER_KEYS:["Control","Alt","Shift","Meta"],SPECIAL_KEYS:{ENTER:13,ESC:27,SPACE:32,TAB:9}},s={ANIMATION_DURATION:300,DEFAULT_DEBOUNCE_DELAY:250}},function(t,e,n){"use strict";n.d(e,"d",function(){return l}),n.d(e,"b",function(){return s}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return i});var o=n(0);function i(t,e){return function(n){let o=e;n.Q("li").forEach(n=>{o+="".concat(t,"<li>").concat(n.innerHTML,"</li>").concat(e)}),n.innerHTML=o}}const r=i("","");function a(t){return s(t,"innerText")}function s(t,e){if(t){if(Object(o.r)(t))return t.textContent.replace(/\u00a0/g," ");switch(t.tagName){case"TEXTAREA":case"INPUT":return t.value;default:return t[e||"innerHTML"]}}}function l(t,e,n,i){if(e=e.toString(),Object(o.r)(t))return t.textContent=e.replace(/ /g," "),t;switch(t.tagName){case"TEXTAREA":case"INPUT":t.value=e.replace("<br>","\n").replace("&nbsp;"," ");break;default:if("innerText"===n)t.innerText=e.replace("<br>","\n").replace("&nbsp;"," ");else try{t.innerHTML=e.replace(/ $/g,"&nbsp;").replace(/ {2}/g," &nbsp;"),i?function(t){const e=t.childNodes.filter(t=>Object(o.r)(t)),n=e.length;let i,a,s,l,c,u,d,p=0;for(;p<n;p++){for(s=0,l=(a=(i=e[p]).textContent.split(/\n/g)).length;s<l;s++)d=a[s],c=document.createTextNode(d),u=o.t.new("br"),t.insertBefore(u,i),t.insertBefore(c,u);t.removeChild(u),t.removeChild(i)}t.Q("pre, blockquote, ol, ul").forEach(t=>{const e=t.nextElementSibling;e&&"BR"===e.tagName&&e.parentNode.removeChild(e)}),t.Q("ol, ul").forEach(r)}(t):t.innerHTML=t.innerHTML.replace(/\n/g,"<br>")}catch(t){console.log("From setHTML: `node` argment is undefined")}}return t}},,,,function(t,e,n){"use strict";n.d(e,"a",function(){return s});var o=n(0),i=n(4),r=n(7),a=n(5);function s(){Date.prototype.isLeapYear=function(){const t=this.getFullYear();return Object(a.f)(t)},Date.prototype.getDayOfYear=function(){const t=this.getMonth(),e=this.getDate();let n=[0,31,59,90,120,151,181,212,243,273,304,334][t]+e;return t>1&&this.isLeapYear()&&n++,n},NodeList.prototype.__proto__=Array.prototype,Number.padNumber=function(t){return((t=parseInt(t,10))<=9?"0":"")+t},String.prototype.unsubstring=function(t,e){return this.substring(0,t)+this.substring(e)},Object(i.a)("trigger",function(t,e){const n=new CustomEvent(t,{detail:e||null});this.dispatchEvent(n)}),Object(i.a)("triggerKeypress",function(t){const e=new Event("input");e.keyCode=t,this.dispatchEvent(e)}),Object(i.a)("on",window.on=function(t,e,n){const o=t.split(/,\s*/g);for(const t of o)this.addEventListener(t,e,n);return this}),Object(i.a)("insertAfter",function(t){return this.parentNode.insertBefore(t,this.nextSibling),this}),Object(i.a)("hasClass",function(t){return this.className&&new RegExp("(^|\\s)".concat(t,"(\\s|$)")).test(this.className)}),Object(i.a)("toggleClass",function(t){return this.classList.toggle(t),this}),Object(i.a)("addClass",function(t){return Array.isArray(t)||(t=[t]),t.forEach(t=>{this.classList.add(t)}),this}),Object(i.a)("removeClass",function(t){return Array.isArray(t)||(t=[t]),t.forEach(t=>{this.classList.remove(t)}),this}),Object(i.a)("isTextBox",function(){return"INPUT"===this.tagName||"TEXTAREA"===this.tagName}),Object(i.a)("attr",function(t,e){return void 0!==e?(this.setAttribute(t,e),this):this.getAttribute(t)}),Object(i.a)("parent",function(t){let e=this.parentElement;for(;e;){if(e.matches(t))return e;e=e.parentElement}return null}),Object(i.a)("html",function(t,e,n){return void 0!==t?Object(r.d)(this,t,e,n):Object(r.b)(this,e)}),Object(i.a)("text",function(t){return this.html(t,"innerText")});for(const[t,e]of Object.entries(o.a))Object(i.a)(t,e)}},function(t,e,n){"use strict";n.r(e);var o=n(0),i=n(11),r=n(4),a=n(1),s=n(3);Object(i.a)(),Object(r.b)(window),console.log("Loaded at: ".concat(new Date));const l="blockSite",c=10,u=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/;let d,p,h,f=0,g=chrome.storage.local;function m(){Data&&Data.snippets&&(a.b.makeFolderIfList(Data),a.b.setIndices())}window.listOfSnippetCtxIDs=[],window.IN_OPTIONS_PAGE=!1;const b=new Promise(t=>{localStorage[s.d]?(g=chrome.storage[localStorage[s.d]]).get(s.e,e=>{window.Data=e[s.e]||s.f,m(),t()}):(window.Data=s.f,m(),t())});function E(t){let e,n=(t=t.replace(/^(ht|f)tps?(:\/\/)?(www\.)?/,"").split("/"))[0],o=t[1];return o&&(-1!==(e=o.indexOf("?"))&&(o=o.substring(0,e)),n+="/".concat(o)),n}function y(){return g.MAX_ITEMS?"sync":"local"}function D(t){if(!Object(o.q)(t))return;const e=chrome.runtime.getManifest().content_scripts[0].js;for(const n of e)chrome.tabs.executeScript(t.id,{file:n})}let S,T,w,C,v;function x(){chrome.tabs.create({url:chrome.extension.getURL("html/options.html#snippets")})}async function P({notifText:t,notifTitle:e,reason:n}){await b,m(),"install"===n&&x(),chrome.tabs.query({},t=>{t.forEach(D)}),chrome.notifications.create("",{type:"basic",iconUrl:"imgs/dotexpander-128.png",title:e,message:t})}function O(t=!1){t?f++:f=0,Data.ctxEnabled&&chrome.tabs.query({active:!0,currentWindow:!0},t=>{const e=t[0];Object(o.q)(e)&&chrome.tabs.sendMessage(e.id,{checkBlockedYourself:!0},Object(o.g)(t=>{void 0===t?(d="Unable to block/unblock",f<=c&&setTimeout(O,500,!0)):(d=t?"Unblock":"Block",t?C():v()),chrome.contextMenus.update(l,{title:"".concat(d," this site")})}))})}async function A(){await b,Data.ctxEnabled?O():C(),S()}async function L(t){await b;const e=await Object(o.g)(chrome.tabs.get,t);e&&(Object(o.q)(e)?A():C())}!function(){let t=!1;S=function(){Data.ctxEnabled&&!t?chrome.contextMenus.create({id:l,title:"reload page for blocking site"},Object(o.g)(()=>{t=!0})):!Data.ctxEnabled&&t&&chrome.contextMenus.remove(l,Object(o.g)(()=>{t=!0}))}}(),chrome.omnibox.onInputChanged.addListener((t,e)=>{T=t,Data.snippets.filterSnippetsForOmnibox(t,([t,...n])=>{w=t||{description:"Sorry, entered text did not match any existing snippet"},chrome.omnibox.setDefaultSuggestion({description:w.description}),e(n)})}),chrome.omnibox.onInputEntered.addListener(t=>{let e,n;t===T&&(n=w.content),e=function(t){return u.test(t.trim())}(n)?n:localStorage.omniboxSearchURL.replace("SEARCH",encodeURIComponent(n)),chrome.tabs.query({currentWindow:!0,active:!0},t=>{chrome.tabs.update(t[0].id,{url:e})})}),h="<div class='prokeys-block block-theme-plain'><div class='block-overlay'></div><div class='block-content'><div class='block-dialog-form'><div class='block-dialog-message'>Are you sure you want to <span class='action'></span><br> <input type='text' class='site-name'><br> from ProKeys?</div><div class='block-dialog-buttons'><input type='button' value='OK' class='block-dialog-button-primary block-dialog-button'><input type='button' value='Cancel' class='block-dialog-button-secondary block-dialog-button'> </div></div></div></div>",function(){let t="",e=!1;C=function(){for(;listOfSnippetCtxIDs.length>0;)chrome.contextMenus.remove(listOfSnippetCtxIDs.pop());t="",e&&(chrome.contextMenus.remove("snippet_main",Object(o.g)()),e=!1)},v=function(){const{snippets:n}=Data,o=JSON.stringify(n.toArray());if(o===t)return;C(),t=o;const i=n.list.length>0;e=!i,i?n.createCtxMenuEntry():chrome.contextMenus.create({contexts:["editable"],id:"snippet_main",title:"No snippet to insert"})}}(),chrome.runtime.onInstalled.addListener(t=>{let e,n;const{reason:i}=t,{version:r}=chrome.runtime.getManifest();if("install"===i)localStorage[s.c]="[]",localStorage[s.d]="local",window.Data=s.f,window.latestRevisionLabel="data created (added defaut snippets)",Object(s.i)(Data.snippets),Object(s.a)(),P({notifText:e="Thank you for installing ProKeys! Please reload all active tabs for changes to take effect.",notifTitle:n="ProKeys successfully installed!",version:r,reason:i});else if("update"===i){const t={notifText:e="Hooray! Please reload active tabs to use the new version.",notifTitle:n="ProKeys updated to v".concat(r),version:r,reason:i};chrome.browserAction.setBadgeText({text:"NEW"}),localStorage.extensionUpdated="true",function(t){localStorage[s.d]="local",chrome.storage.local.get(s.e,e=>{!1===e[s.e].snippets&&(localStorage[s.d]="sync"),t()})}(()=>(function(t){g=chrome.storage[localStorage[s.d]],window.latestRevisionLabel="",g.get(s.e,Object(o.g)(e=>{window.Data=e[s.e],P(t)}))})(t))}}),chrome.contextMenus.onClicked.addListener(t=>{const e=t.menuItemId,n=t.pageUrl;let i,r,s;e===l?(i={task:"showModal",action:d,url:E(n),modal:h},chrome.tabs.query({active:!0,currentWindow:!0},t=>{Object(o.q)(t[0])&&chrome.tabs.sendMessage(t[0].id,i,Object(o.g)())})):a.c.CTX_SNIP_REGEX.test(e)&&(r=a.c.CTX_START[a.c.SNIP_TYPE].length,s=Data.snippets.getUniqueSnip(e.substring(r)),chrome.tabs.query({active:!0,currentWindow:!0},t=>{const e=t[0];Object(o.q)(e)?chrome.tabs.sendMessage(e.id,{clickedSnippet:s.toArray(),ctxTimestamp:p},Object(o.g)()):e.url&&alert("Sorry, context menu insertion doesn't work in the chrome:// tabs or in the Webstore!")}))}),chrome.tabs.onActivated.addListener(({tabId:t})=>L(t)),chrome.tabs.onUpdated.addListener((t,e,n)=>{"complete"===n.status&&L(t)}),chrome.runtime.onMessage.addListener((t,e,n)=>{if(void 0!==t.updateCtx)v();else if(!0===t.openBlockSiteModalInParent)chrome.tabs.query({active:!0,currentWindow:!0},e=>{const n=e[0];Object(o.q)(n)&&chrome.tabs.sendMessage(n.id,{showBlockSiteModal:!0,data:t.data},Object(o.g)())});else if(void 0!==t.ctxTimestamp)p=t.ctxTimestamp;else if("givePasteData"===t)n(function(){const t=o.t.new("textarea"),e=document.activeElement.appendChild(t).parentNode;t.focus(),document.execCommand("Paste",null,null);const n=t.value;return e.removeChild(t),n}());else if(void 0!==t.ctxEnabled)Data.ctxEnabled=t.ctxEnabled,A();else if(void 0!==t.giveData){const t=Data.snippets;Data.snippets=Data.snippets.toArray();const e=JSON.parse(JSON.stringify(Data));Data.snippets=t,n(e)}else{if(void 0!==t.updateData)return Data=t.updateData,Object(s.a)(()=>{Data.snippets&&m(),n("done")}),!0;if(void 0!==t.getStorageType)n(y());else{if(void 0!==t.changeStorageType){const e=["local","sync"],o=y(),i=e[1-e.indexOf(o)],r=Data;return g=chrome.storage[i],localStorage[s.d]=i,g.get(e=>{window.Data=e[s.e],"undefined"!=typeof Data||t.overridingSync?(m(),n({completed:!0})):(window.Data=r,m(),g=chrome.storage[o],localStorage[s.d]=o,n({completed:!1}))}),!0}if(void 0!==t.getBytesInUse)return g.getBytesInUse(Object(o.g)(t=>{n(t)})),!0}}return!1}),chrome.browserAction.onClicked.addListener(x),chrome.runtime.setUninstallURL("https://docs.google.com/forms/d/e/1FAIpQLSdDAd8a1Edf4eUXhM4E1GALziNk6j1QYjI6gUqGdAXdYrueaw/viewform"),chrome.runtime.onInstalled.addListener(t=>{chrome.storage.local.set({extensionUpdated:!0}),chrome.action.setBadgeText({text:"NEW"}),initialize().catch(console.error)})}]);